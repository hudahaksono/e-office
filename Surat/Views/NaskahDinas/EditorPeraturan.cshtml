@model Surat.Models.Entities.DraftSurat

@{
    var lstskemattd = new List<SelectListItem>();
    lstskemattd.Add(new SelectListItem { Text = "Langsung", Value = "L" });
    lstskemattd.Add(new SelectListItem { Text = "Atas Nama", Value = "AN" });
    var lstJenisTujuan = new List<SelectListItem>();
    lstJenisTujuan.Add(new SelectListItem { Text = "Pilih Berdasarkan Data Kantor", Value = "bpn" });
    lstJenisTujuan.Add(new SelectListItem { Text = "Teks Bebas", Value = "lain" });
    var lstnull = new List<SelectListItem>();
    var lstPosisiTTE = new List<SelectListItem>();
    lstPosisiTTE.Add(new SelectListItem { Text = "Halaman Terakhir", Value = "terakhir" });
    lstPosisiTTE.Add(new SelectListItem { Text = "Halaman Pertama", Value = "pertama" });
    var lstUnitPetugas = new List<SelectListItem>();
    foreach (var unit in ViewBag.ListUnitKerjaForSelect)
    {
        lstUnitPetugas.Add(new SelectListItem { Text = unit.NamaUnitKerja, Value = unit.UnitKerjaId });
    }
    lstUnitPetugas.Add(new SelectListItem { Text = "Pegawai Lainnya...", Value = "999" });
    var listAtasNama = new List<SelectListItem>();
    foreach (var p in ViewBag.ListAtasNama)
    {
        listAtasNama.Add(new SelectListItem { Text = p.NamaProfile, Value = p.ProfileId });
    }
}


<script src='@Url.Content("~/resources/js/jquery.form.js")' type="text/javascript"></script>
<script src='@Url.Content("~/resources/js/jqueryautocomplete/jquery.autocomplete.js")' type="text/javascript"></script>
<script src='@Url.Content("~/resources/tinymce/tinymce.min.js")'></script>

<style>
    .hapusField {
        color: transparent;
        font-size: 15px;
        padding: 2px;
    }

        .hapusField:hover {
            cursor: pointer;
            display: block;
            color: white;
            background-color: red;
        }

    .loader,
    .loader:before,
    .loader:after {
        border-radius: 50%;
        width: 2.5em;
        height: 2.5em;
        -webkit-animation-fill-mode: both;
        animation-fill-mode: both;
        -webkit-animation: load7 1.8s infinite ease-in-out;
        animation: load7 1.8s infinite ease-in-out;
    }

    .loader {
        color: #171717;
        font-size: .5em;
        margin: 0 auto;
        position: relative;
        text-indent: -9999em;
        -webkit-transform: translateZ(0);
        -ms-transform: translateZ(0);
        transform: translateZ(0);
        -webkit-animation-delay: -0.16s;
        animation-delay: -0.16s;
    }

        .loader:before,
        .loader:after {
            content: '';
            position: absolute;
            top: 0;
        }

        .loader:before {
            left: -3.5em;
            -webkit-animation-delay: -0.32s;
            animation-delay: -0.32s;
        }

        .loader:after {
            left: 3.5em;
        }

    @@-webkit-keyframes load7 {
        0%,
        80%,
        100% {
            box-shadow: 0 2.5em 0 -1.3em;
        }

        40% {
            box-shadow: 0 2.5em 0 0;
        }
    }

    @@keyframes load7 {
        0%,
        80%,
        100% {
            box-shadow: 0 2.5em 0 -1.3em;
        }

        40% {
            box-shadow: 0 2.5em 0 0;
        }
    }


    .editableContent[placeholder]:empty::before,
    .editArea[placeholder]:empty::before {
        content: attr(placeholder);
        color: #939393;
    }

    .editableContent[placeholder]:empty:focus::before,
    .editArea[placeholder]:empty:focus::before {
        content: "";
    }
    #PetugasContainer tbody tr td{
        cursor:default;
    }

    #PetugasContainer tbody tr td i {
        cursor: pointer;
    }
    #PetugasContainer tbody tr td i:hover{
        color:darkblue
    }

    .editableTools {
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
        position: absolute;
        right: 100%;
        padding: 0;
        width: 60px;
        margin-right:10px;
    }
    .editableTools button{
        width:60px;
    }
</style>

<div class="">
    <div class="page-title">
        <div class="title_left"><h2 style="width:100%"><span id="LabelTitle">Editor Konsep Surat - <b>@ViewBag.Judul</b></span></h2></div>
        <div class="title_right" style="text-align:right;">
            <div class="pull-right">
                <span class="input-group-btn" style="padding-right:2px;">
                    @if (!string.IsNullOrEmpty(Model.DraftCode) && !Model.Status.Equals("P") && !ViewBag.Verif)
                    {
                        <button type="button" id="perubahan" class="btn btn-primary">Infokan Perubahan</button>
                    }
                    else if (!string.IsNullOrEmpty(Model.DraftCode) && !Model.Status.Equals("P") && ViewBag.Verif)
                    {
                        <button type="button" id="perubahanverifikator" class="btn btn-warning">Infokan Perubahan Verifikator</button>
                    }
                    else if (string.IsNullOrEmpty(Model.DraftCode) || Model.Status.Equals("P"))
                    {
                        <button type="button" id="btnsimpan" class="btn btn-info" disabled>Ajukan Konsep</button>
                    }
                    <button id="cancel-btn" type="button" class="btn btn-warning" onclick=" backToFront()">Kembali</button>f
                </span>
            </div>
        </div>
    </div>

    <div class="row x_panel tile" style="padding-top:7px; border:1px solid #E6E9ED;">
        <div class="x_content">
            <div class="" role="tabpanel" data-example-id="togglable-tabs" id="tabs">
                <span class="input-group-btn pull-right" style="padding-right:2px;">
                    <button id="preview-btn" type="button" class="btn btn-primary pull-right" onclick="DoTampilkanDokumen()">Simpan dan Tampilkan Draft</button>
                </span>
                <ul id="actTabs" class="nav nav-tabs hidden-print" role="tablist">
                    <li role="presentation" class="@if (!ViewBag.Tampil) { <text>active</text>}">
                        <a href="#tab1" role="tab" id="step1-tab" data-toggle="tab" aria-expanded="true">Pengenal</a>
                    </li>
                    @{var mengingatHead = "";}
                    @if (Model.TipeSurat != "Surat Pernyataan")
                    {
                            <li role="presentation" class="" id="tabStep2">
                                <a href="#tab2" role="tab" id="step2-tab" data-toggle="tab" aria-expanded="false">Menimbang</a>
                            </li>

                        <li role="presentation" class="" id="tabStep3">
                            <a href="#tab3" role="tab" id="step3-tab" data-toggle="tab" aria-expanded="false">
                                @{
                                    if (Model.TipeSurat == "Surat Keputusan")
                                    {
                                        mengingatHead = "Mengingat";
                                    }
                                    else if (Model.TipeSurat == "Surat Tugas" || Model.TipeSurat == "Surat Perintah")
                                    {
                                        mengingatHead = "Dasar";
                                    }
                                }
                                @mengingatHead
                            </a>
                        </li>
                    }

                    <li role="presentation" class="" id="tabStep4">
                        <a href="#tab4" role="tab" id="step4-tab" data-toggle="tab" aria-expanded="false">
                            @{
                                var memutuskanHead = "";
                                if (Model.TipeSurat == "Surat Keputusan")
                                {
                                    memutuskanHead = "Memutuskan";
                                }
                                else if (Model.TipeSurat == "Surat Tugas")
                                {
                                    memutuskanHead = "Memberi Tugas";
                                }
                                else if (Model.TipeSurat == "Surat Pernyataan")
                                {
                                    memutuskanHead = "Pembuat Pernyataan";
                                }
                                else if (Model.TipeSurat == "Surat Perintah")
                                {
                                    memutuskanHead = "Memberi Perintah";
                                }
                            }
                            @memutuskanHead
                        </a>
                    </li>
                    <li role="presentation" class="" id="tabStep5">
                        <a href="#tab5" role="tab" id="step5-tab" data-toggle="tab" aria-expanded="false">Penandatangan</a>
                    </li>
                    <li role="presentation" class="" id="tabStep7">
                        <a href="#tab7" role="tab" id="step7-tab" data-toggle="tab" aria-expanded="false">Lampiran</a>
                    </li>
                    <li role="presentation" class="@if (ViewBag.Tampil) { <text> active </text>}" id="tabStep6" @if (!ViewBag.Tampil) { <text> style="display:none" </text>}>
                        <a href="#tab6" role="tab" id="step6-tab" data-toggle="tab" aria-expanded="false">Tampilan</a>
                    </li>
                </ul>
            </div>
            
            @Html.HiddenFor(m => m.DraftCode)
            @Html.HiddenFor(m => m.UnitKerjaId)
            @Html.HiddenFor(m => m.TipeSurat)
            <div id="tab-content" class="tab-content">
                @*TAB 1 PENGENAL*@
                <div role="tabpanel" class="tab-pane fade @if (!ViewBag.Tampil) { <text>active in</text>}" id="tab1" aria-labelledby="step1-tab">
                    <div class="x_panel">
                        <div class="x_title">
                            <h2>Pengenal Dokumen</h2>
                            <div class="clearfix"></div>
                        </div>
                        <div class="x_content">
                            <div class="row">
                                <div class="col-md-5 col-sm-5 col-xs-12">
                                    <div class="form-group">
                                        <label class="control-label" for="kopsurat">Kop Surat <span style="color:red">*</span></label>
                                        <div class="input-group">
                                            @Html.DropDownListFor(model => model.KopSurat, Model.ListKodeKopSurat, new { @class = "select2_single form-control input-md ", @id = "kopsurat", @required = "required" })
                                        </div>
                                        <small>@Html.ValidationMessageFor(model => model.KopSurat, "", new { @class = "error" })</small>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label" for="kodearsip">Kode Arsip <span style="color:red">*</span></label>

                                        <div class="input-group" style="margin-bottom:0px">
                                            @Html.TextBoxFor(model => model.KodeArsip, new { @class = "form-control formfull", @id = "kodearsip", @maxlength = "10", @required = "required", @placeholder = "Contoh:TU.01.02" })
                                            <span class="input-group-addon" style="cursor:pointer" onclick="SrchKlasArsip()">
                                                <i class="fa fa-search"></i>
                                            </span>
                                        </div>
                                        <small>@Html.ValidationMessageFor(model => model.KodeArsip, "", new { @class = "error" })</small>
                                    </div>
                                </div>
                                <div class="col-md-7 col-sm-7 col-xs-12">

                                    <div class="form-group">
                                        <label class="control-label" for="">Pengirim Surat (Penandatangan Surat) <span style="color:red">*</span></label>
                                        <div class="input-group">
                                            <div class="input-group-addon bg-blue" style="cursor:pointer" onclick='$("#settingPenandatangan").modal("show")'><i class="fa fa-hand-pointer-o"></i> &nbsp;Pilih</div>
                                            <input type="text" class="form-control" id="TampilanPengirim" placeholder="Penandatangan Belum Dipilih...." readonly>
                                        </div>
                                        <small id="errtujuanPenandatangan" class="error" style="display:none">Pengirim Surat (Penandatangan) Kosong</small>
                                    </div>

                                    <div class="form-group">
                                        @if (Model.TipeSurat == "Surat Tugas")
                                        {
                                            <label class="control-label" for="perihal">Ringkasan Tugas<span style="color:red">*</span></label>
                                        }
                                        else
                                        {
                                            <label class="control-label" for="perihal">Hal <span style="color:red">*</span></label>
                                        }
                                    <div class="row" style="padding-left:10px">
                                        <div id="PerihalContent" class="col-lg-11 col-md-10 col-sm-10 col-xs-10" style="border: 1px solid #ccc;min-height:100px; padding:10px; color:black" contenteditable="true">

                                        </div>
                                        <div class="btn-group-vertical col-lg-1 col-md-2 col-sm-2 col-xs-2 perihalTools" role="group" aria-label="...">
                                            <button type="button" class="btn btn-default" data-style="bold"><b>B</b></button>
                                            <button type="button" class="btn btn-default" data-style="italic"><i>I</i></button>
                                            <button type="button" class="btn btn-default" data-style="underline"><u>U</u></button>
                                        </div>
                                    </div>
                                    </div>
                                </div>
                                <div>
                                    <div class="x_title">
                                        <h2 class="mytitleform">Tembusan</h2>
                                        <div class="clearfix"></div>
                                    </div>
                                    <div class="form-group">
                                        @Html.DropDownList("jenistembusan", lstJenisTujuan, new { @class = "select2_single form-control formfull", @onchange = "tembusansuratberubah(this)" })
                                    </div>
                                    <div class="form-group" id="div_tembusanEX">
                                        <div class="input-group" style="margin-bottom:0px">
                                            @Html.TextBox("tembusanEX", "", new { @class = "form-control", type = "text" })
                                            <div class="input-group-btn">
                                                <label class="btn btn-success" style="margin-right:0" onclick="tambahtembusan('ex','text')">
                                                    <i class="fa fa-plus"></i>&nbsp;Tambah
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group" id="div_tembusanIN">
                                        <div style="margin-bottom:10px">
                                            <select class="select2_single form-control formfull" data-redaksi="tembusan" onchange="GetPegawaibyUnit(this)">
                                                <option>Pilih Unit Kerja</option>
                                                @try
                                                {
                                                    foreach (var unit in ViewBag.ListUnitKerja)
                                                    {
                                                        <option value="@unit.UnitKerjaId">@unit.NamaUnitKerja</option>
                                                    }
                                                }
                                                catch
                                                {
                                                    <option value="Error">Gagal Mengambil Data</option>
                                                }
                                            </select>
                                        </div>
                                        <div class="input-group" style="margin-bottom:0px">
                                            @Html.DropDownList("tembusanIN", lstnull, new { @class = "select2_single form-control formfull" })
                                            <div class="input-group-btn">
                                                <label class="btn btn-success" style="margin-right:0" onclick="tambahtembusan('in','text')">
                                                    <i class="fa fa-plus"></i>&nbsp;Simpan
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <table class="table table-striped table-bordered" style="width:100%;margin-bottom:0px;">
                                            <tr>
                                                <th>Nama Tembusan</th>
                                                <th style="width:57px"></th>
                                            </tr>
                                        </table>
                                        <div class="table-responsive" style="margin-bottom:0px;overflow-y:scroll;height:180px;">
                                            <table id="tblTembusanSurat" class="table table-striped table-bordered" style="width:100%;">
                                                <tbody id="datatembusan"><tr><td colspan="2" style="text-align:center;">Tembusan Kosong</td></tr></tbody>
                                            </table>
                                        </div>
                                        @Html.Hidden("ListTembusanSurat")
                                    </div>
                                </div>
                                @*<div>
                                        <div class="x_title">
                                            <h2 class="mytitleform">File Surat</h2>
                                            <div class="clearfix"></div>
                                        </div>
                                        <div class="form-group">
                                            <div class="col-md-2 col-sm-2 col-xs-12">
                                                <span class="btn btn-primary btn-file"><i class="fa fa-file-pdf-o"></i>&nbsp;&nbsp;Pilih File<input type="file" name="UploadFromFile" id="txtUploadFile" class="btn btn-primary" accept=".pdf" /></span>
                                            </div>
                                        </div>
                                        <div class="table-responsive" style="padding-right:10px; padding-left:10px;">
                                            <table id="myTableFile" class="table table-striped table-bordered dt-responsive" style="width:100%">
                                                <thead>
                                                    <tr>
                                                        <th>#</th>
                                                        <th>File</th>
                                                        <th>Lihat</th>
                                                        <th>Hapus</th>
                                                    </tr>
                                                </thead>
                                                <tbody></tbody>
                                            </table>
                                        </div>
                                    </div>*@
                            </div>
                        </div>
                    </div>
                </div>

                @*TAB 2 MENIMBANG*@
                <div role="tabpanel" class="tab-pane fade" id="tab2" aria-labelledby="step2-tab">
                    <div class="x_panel">
                        <div class="x_title">
                            <div class="clearfix"></div>
                        </div>
                        <div class="x_content">
                            <div class="row">
                                <div class="col-md-2 col-sm-12 co-xs-12" style="padding-right:0">
                                    <span><b>Menimbang</b></span>
                                    <br />
                                </div>
                                <div class="col-md-10 col-sm-12 col-xs-12" style="padding-left:0">
                                    <div id="menimbang">
                                        <div class="form-group" id="menimbangField1">
                                            <div id="menimbang1" class="editableContent textinput" style="border: 1px solid #ccc;min-height:100px; padding:10px; color:black" contenteditable="true" placeholder="bahwa berdasarkan pertimbangan ........"></div>

                                            @*<span class="hapusField" onclick="hapus('menimbangField1')" style="position:absolute; top:1px; right: 15px;"><i class="fa fa-trash"></i> Hapus</span>*@
                                            @*@Html.TextArea("menimbang1", new { @class = "form-control formfull", @rows = 5, @required = "required", @placeholder = "bahwa berdasarkan pertimbangan ........" })*@
                                        </div>
                                    </div>
                                    <br />
                                    <br />
                                    <div class="input-group-btn">
                                        <label class="btn btn-primary" style="margin-right:0; width:100%" onclick="tambahMenimbang()">
                                            <i class="fa fa-plus"></i>&nbsp;Kolom Baru
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                @*TAB 3 MENGINGAT*@
                <div role="tabpanel" class="tab-pane fade" id="tab3" aria-labelledby="step3-tab">
                    <div class="x_panel">
                        <div class="x_title">
                            <div class="clearfix"></div>
                        </div>
                        <div class="x_content">
                            <div class="row">
                                <div class="col-md-2 col-sm-10 co-xs-12" style="padding-right:0">
                                    <span><b>@mengingatHead</b></span>
                                </div>
                                <div class="col-md-10 col-sm-12 col-xs-2" style="padding-left:0">
                                    <div id="mengingat">
                                        <div class="form-group" id="mengingatField1">
                                            <div id="mengingat1" class="editableContent textinput" style="border: 1px solid #ccc;min-height:100px; padding:10px; color:black" contenteditable="true" placeholder="Undang-Undang Nomor ........ (Lembaran Negara ........ )"></div>

                                            @*<span class="hapusField" onclick="hapus('mengingatField1')" style="position:absolute; top:1px; right: 15px;"><i class="fa fa-trash"></i> Hapus</span>*@
                                            @*@Html.TextArea("mengingat1", new { @class = "form-control formfull", @rows = 5, @required = "required", @placeholder = "Undang-Undang Nomor ........ (Lembaran Negara ........ )" })*@
                                        </div>
                                    </div>
                                    <br />
                                    <br />
                                    <div class="input-group-btn">
                                        <label class="btn btn-primary" style="margin-right:0; width:100%" onclick="tambahMengingat()">
                                            <i class="fa fa-plus"></i>&nbsp;Kolom Baru
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                @*TAB 4 MEMUTUSKAN*@
                <div role="tabpanel" class="tab-pane fade" id="tab4" aria-labelledby="step4-tab">
                    <div class="x_panel">
                        <div class="x_title">
                            <h2>@memutuskanHead.ToUpper() :</h2>
                            <div class="clearfix"></div>
                        </div>
                        @if (Model.TipeSurat == "Surat Keputusan")
                        {
                            <div class="x_content">
                                <div class="row">
                                    <div class="col-md-2 col-sm-10 co-xs-12" style="padding-right:0">
                                        <span><b>Menetapkan</b></span>
                                    </div>
                                    <div class="col-md-10 col-sm-12 col-xs-2" style="padding-left:0">
                                        <div id="menetapkan">
                                            <div class="form-group" id="menetapkanField1">
                                                <div id="menetapkan1" class="editableContent" style="border: 1px solid #ccc;min-height:100px; padding:10px; color:black" contenteditable="true" placeholder="KEPUTUSAN MENTERI AGRARIA DAN TATA RUANG / KEPALA BADAN PERTANAHAN NASIONAL TENTANG ........"></div>
                                                @*<span class="hapusField" onclick="hapus('menetapkanField1')" style="position:absolute; top:1px; right: 15px;"><i class="fa fa-trash"></i> Hapus</span>*@
                                                @*@Html.TextArea("menetapkan1", new { @class = "form-control formfull", @rows = 5, @required = "required", @placeholder = "KEPUTUSAN MENTERI AGRARIA DAN TATA RUANG / KEPALA BADAN PERTANAHAN NASIONAL TENTANG ........" })*@
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <hr />
                                <div class="row">
                                    <div id="keberapa">
                                        <div id="keberapaField1" class="keberapaFieldText">
                                            <div class="col-md-2 col-sm-10 co-xs-12">
                                                <div class="form-group">
                                                    <input type="text" id="pertama" value="" placeholder="KE...." class="form-control ReeditableTools" />
                                                </div>
                                            </div>
                                            <div class="col-md-10 col-sm-12 col-xs-2" style="padding-left:0">
                                                <div class="form-group">
                                                    <div id="keberapa1" class="editArea textinput editableContent" style="border: 1px solid #ccc;min-height:100px; padding:10px; color:black" contenteditable="true" placeholder="memutuskan bahwa ........"></div>
                                                    @*@Html.TextArea("keberapa1", new { @class = "form-control formfull", @rows = 5, @required = "required", @placeholder = "memutuskan bahwa ........" })*@
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="input-group-btn"  style="padding-top:50px">
                                        <label class="btn btn-primary" style="margin-right:0; width:100%" onclick="tambahKeberapa()">
                                            <i class="fa fa-plus"></i>&nbsp;Kolom Baru
                                        </label>
                                    </div>
                                </div>
                            </div>
                        }
                        else if (Model.TipeSurat == "Surat Tugas" || Model.TipeSurat == "Surat Pernyataan" || Model.TipeSurat == "Surat Perintah")
                        {
                            <div class="x_content">
                                <div class="row">
                                    <div class="col-md-2 col-sm-10 co-xs-12" style="padding-right:0">
                                        <span><b>Kepada :</b></span>
                                    </div>
                                    <div class="col-md-10 col-sm-12 col-xs-12" style="padding-left:0">
                                        <div id="menetapkan">
                                            <div class="col-md-8 col-sm-8 col-xs-11" style="padding:0;border:1px solid #ECECEC;min-height:200px">
                                                <table id="PetugasContainer" class="table table-condensed table-bordered">
                                                    <thead>
                                                        <tr>
                                                            <th>Nama</th>
                                                            <th>Jabatan</th>
                                                            <th>&nbsp;&nbsp;&nbsp;&nbsp;</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                    </tbody>
                                                </table>
                                            </div>
                                            <div class="col-md-4 col-sm-4 col-xs-1">
                                                <label class="btn btn-success" onclick="$('#PetugasModal').modal('show')">
                                                    <i class="fa fa-plus-circle"></i>&nbsp;Tambah
                                                </label>
                                                <label class="jumlahPetugas">
                                                    Jumlah dipilih : <span>0</span>
                                                </label>
                                                <select id="optPetugas" class="form-control input-md">
                                                    <option value="1">Badan Surat</option>
                                                    <option value="0">Lampirkan</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row" style="margin-top:10px">
                                    <div class="col-md-2 col-sm-10 co-xs-12" style="padding-right:0">
                                        <span><b>Untuk :</b></span>
                                    </div>
                                    <div class="col-md-10 col-sm-12 col-xs-12" style="padding-left:0">
                                        <div id="menetapkanUntuk">
                                            <div class="form-group" id="menetapkanField1">
                                                @{ var placeholder = "";}
                                                @if (Model.TipeSurat == "Surat Pernyataan")
                                                {
                                                    <textarea id="UntukPernyataan"></textarea>
                                                }
                                                else
                                                {
                                                    { placeholder = Model.TipeSurat == "Surat Tugas" ? "Melakukan Perjalanan Dinas Ke ........" : "Memerintahkan Untuk......"; }
                                                    <div id="UntukTgs" class="editableContent textinput" style="border: 1px solid #ccc;min-height:100px; padding:10px; color:black" contenteditable="true" placeholder="@placeholder"></div>
                                                }
                                            </div>
                                        </div>

                                        @if (Model.TipeSurat == "Surat Perintah")
                                        {
                                            <div class="input-group-btn">
                                                <label class="btn btn-primary" style="margin-right:0; width:100%" onclick="tambahUntuk()">
                                                    <i class="fa fa-plus"></i>&nbsp;Kolom Baru
                                                </label>
                                            </div>
                                        }
                                    </div>
                                </div>
                            </div>
                        }

                    </div>
                </div>

                @*TAB 5 PENANDATANGAN*@
                <div role="tabpanel" class="tab-pane fade" id="tab5" aria-labelledby="step5-tab">
                    <div class="x_panel">
                        <div class="x_title">
                            <h2>Penandatangan</h2>
                            <span class="input-group-btn pull-right" style="padding-right:2px;">
                                <button type="button" class="btn btn-success pull-right" onclick="goStep(4,5)">Berikutnya</button>
                            </span>
                            <div class="clearfix"></div>
                        </div>
                        <div class="x_content">
                            <form data-parsley-validate id="frmStep4" role="form" method="post">
                                <div class="col-md-12 col-sm-12 col-xs-12">
                                    <div class="form-group">
                                        <table class="table table-striped table-bordered" style="width:100%;margin-bottom:0px;">
                                            <tr>
                                                <th style="width:152px">NIP</th>
                                                <th style="width:123px">Nama</th>
                                                <th>Jabatan</th>
                                                <th style="width:100px">Tipe</th>
                                                <th style="width:57px"></th>
                                            </tr>
                                        </table>
                                        <div class="table-responsive" style="margin-bottom:0px;overflow-y:scroll;height:400px;">
                                            <table id="tblPenandatangan" class="table table-striped table-bordered" style="width:100%;">
                                                <tbody id="datatte"><tr><td colspan="5" style="text-align:center;">Penandatangan Kosong</td></tr></tbody>
                                            </table>
                                        </div>
                                        @Html.Hidden("UserTTE")
                                    </div>
                                </div>
                                <div class="col-md-12 col-sm-12 col-xs-12">
                                    <div class="form-group">
                                        <div class="form-group">
                                            <button id="BtnTambahTandaTangan" type="button" class="btn btn-success pull-right"><i class="fa fa-plus"></i> Tanda Tangan</button>
                                            <button id="BtnTambahParaf" type="button" class="btn btn-success pull-right"><i class="fa fa-plus"></i> Paraf</button>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>

                    </div>
                </div>

                @*TAB 6 TAMPILAN*@
                <div role="tabpanel" class="tab-pane fade @if (ViewBag.Tampil) { <text>active in</text>}" id="tab6" aria-labelledby="step6-tab">
                    <div class="x_panel">
                        <div class="x_title">
                            <h2>Tampilan Dokumen</h2>
                            <div class="clearfix"></div>
                        </div>
                        <div class="x_content">
                            <DIV data-parsley-validate id="frmStep5" role="form" method="post">
                                <div class="col-md-3 col-sm-6 col-xs-12" style="display:none;">
                                    <div class="form-group">
                                        <label class="control-label" for="posisitte">Posisi TTE <span style="color:red">*</span></label>
                                        @Html.DropDownListFor(model => model.PosisiTTE, lstPosisiTTE, new { @class = "form-control formfull", @id = "posisitte", @required = "required" })
                                        <small>@Html.ValidationMessageFor(model => model.PosisiTTE, "", new { @class = "error" })</small>
                                    </div>
                                </div>
                                <div class="col-md-12 col-sm-12 col-xs-12">
                                    <div id='tampilanDokumen'></div>
                                </div>
                            </DIV>
                        </div>
                    </div>
                </div>
                @*TAB 7 LAMPIRAN*@
                <div role="tabpanel" class="tab-pane fade" id="tab7" aria-labelledby="step7-tab">
                    <div class="x_panel">
                        <div class="x_title">
                            <h2>Lampiran</h2>
                            <div class="clearfix"></div>
                        </div>
                        <div class="x_content">
                            @*<div class="form-group" id="divUpload">
                                @Html.HiddenFor(m => m.LampiranId)
                                <div class="input-group" style="margin-bottom:0px">
                                    @Html.TextBoxFor(model => model.NamaFileLampiran, new { @class = "form-control", id = "namafile", type = "text", @readonly = "readonly", @onclick = "$('#btnUploadFile').click();" })
                                    <div class="input-group-btn">
                                        <label class="btn btn-success btn-file">
                                            <i class="fa fa-search"></i><input class="" type="file" name="filename" id="btnUploadFile" accept=".pdf" hidden style="width:70px;">
                                        </label>
                                    </div>
                                </div>
                                <small><span id="validFile" class="error"></span></small>
                            </div>
                            <div id='fileDokumen'></div>*@
                            <form data-parsley-validate id="frmStep3" role="form" method="post">
                                <div class="uploadsection">
                                    <div id="fileUploaded">
                                        <ul class="nav nav-tabs">
                                            <li class="active" role="presentation" onclick="btnTambahFileUp()"><a style="cursor:pointer" id="tambahFile"><i class="fa fa-plus-square" style="font-size:1.2em"></i>&nbsp;Tambah File</a></li>
                                        </ul>
                                        <div class="tab-content" id="tabPdf">
                                        </div>
                                    </div>
                                    <div id="fileHide">
                                        <input type="file" id="file1" name="fileUploadStream" style="display:none">
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div id='myModalDocViewer' class='modal'>
    <div class="modal-dialog">
        <div class="modal-content">
            <div id='myModalContent'></div>
        </div>
    </div>
</div>

<div id='ListPegawaiModal' class='modal'>
    <div class="modal-dialog">
        <div class="modal-content">
            <div id='myModalContent'>
                <div class="col-md-12 col-sm-12 col-xs-12">
                    <div class="x_panel" style="padding:20px">
                        <div class="x_title">
                            <h2 id="popuptitle">Daftar Pegawai</h2>
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="fa fa-times"></i></button>
                            <div class="clearfix"></div>
                        </div>
                        <div class="x_content">
                            <div class="row">
                                <div class="table-responsive" style="padding-right:10px;">
                                    <form id="frmDaftarPegawai">
                                        <div class="form-group">
                                            <label class="control-label" for="slctUnitKerja">Unit Kerja: </label>
                                            @Html.DropDownList("slctUnitKerja", Model.ListForTTE, new { @class = "form-control", @onchange = "dtabeldaftarpegawaireload()" })
                                        </div>
                                        <div class="form-group">
                                            <label class="control-label" for="txtJabatan">Jabatan</label>
                                            @Html.TextBox("txtJabatan", "", new { @class = "form-control" })
                                        </div>
                                        <div class="form-group">
                                            <label class="control-label" for="txtNama">Nama</label>
                                            @Html.TextBox("txtNama", "", new { @class = "form-control" })
                                        </div>
                                        <div class="form-group">
                                            <button type="button" class="btn btn-success" id="btncaripegawai">Cari</button>
                                            <button type="button" class="btn btn-warning" data-dismiss="modal">Batal</button>
                                        </div>
                                    </form>
                                    <table id="myTableDaftarPegawai" class="table table-striped hover" style="width:100%;">
                                        <thead>
                                            <tr>
                                                <th style="width:5%">#</th>
                                                <th>NIP</th>
                                                <th>Nama</th>
                                                <th>Jabatan</th>
                                                <th style="width:10%">Pilih</th>
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="EditPetugas" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="editPetugasModal">
     <div class="modal-dialog modal-lg" role="document" style="padding-top:10%">
         <div class="modal-content" style="padding:20px;">
             <div class="form-group">
                 <label for="NamaPetugas">Nama :</label>
                 <input type="text" class="form-control" id="NamaPetugas" placeholder="............">
             </div>
             <div class="form-group">
                 <label for="NIPPetugas">NIP/NIK :</label>
                 <input type="text" class="form-control" id="NIPPetugas" placeholder="............">
             </div>
             <div class="form-group">
                 <label for="PangkatPetugas">Pangkat :</label>
                 <input type="text" class="form-control" id="PangkatPetugas" placeholder="............">
             </div>
             <div class="form-group">
                 <label for="JabatanPetugas">Jabatan :</label>
                 <input type="text" class="form-control" id="JabatanPetugas" placeholder="............">
             </div>
             <button type="button" id="simpanEditPetugas" class="btn btn-info btn-block" style="margin-top:20px">Simpan</button>
         </div>
    </div>
</div>

<div id="arsipModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
    <div class="modal-dialog modal-lg" role="document" style="padding-top:30px">
        <div class="modal-content" style="padding:20px">
            <div class="row" style="margin-bottom:20px">
                <div class="col-md-6 col-sm-6 col-xs-12">
                    <h2>Kode Klasifikasi</h2>
                </div>
                @*<div class="col-md-6 col-sm-6 col-xs-12">
                        <div class="input-group" style="margin-bottom:0px">
                            @Html.TextBox("srchArsipTxt", "", new { @class = "form-control formfull", @id = "srchArsipTxt", @maxlength = "10", @required = "required", @placeholder = "Cari Kode Klasifikasi", @style = "border-top-left-radius:10px;border-bottom-left-radius:10px;" })
                            <span class="input-group-addon" style="cursor:pointer;border-bottom-right-radius:10px;border-top-right-radius:10px" onclick="SrchKlasArsip()">
                                <i class="fa fa-search"></i>
                            </span>
                        </div>
                    </div>*@
            </div>
            <div id="arspiloader" style="padding-bottom:80px">
                <div class="loader">Loading...</div>
            </div>
            <div id="contentholder">

            </div>
            @*<div id="navigasiPage" style="padding-bottom:15px">
                <span id="leftAr" style="cursor:pointer;" onclick="nextpage('left')"><i class="fa fa-arrow-left" style="font-size:2em"></i></span>
                <span id="RightAr" class="pull-right" style="cursor:pointer;" onclick="nextpage('right')"><i class="fa fa-arrow-right" style="font-size:2em"></i></span>
            </div>*@
        </div>
    </div>
</div>

    <div id="PetugasModal" class="modal fade">
        <div class="modal-dialog modal-lg" role="document" style="padding-top:30px">
            <div class="modal-content" style="padding:20px">
                <h2 class="text-center">Pilih Pegawai</h2>
                <div style="min-height:200px">
                    <form id="frmPetugas">
                        <div class="form-group">
                            <label class="control-label" for="UnitKerjaPetugas">Unit Kerja :</label>
                            @Html.DropDownList("UnitKerjaDetail", lstUnitPetugas, "", new { @class = "form-control select2_single", onchange = "SelectOptUnitKerja()", @style = "width:100%" })
                        </div>
                    </form>
                    <div id="normalPickSelect">
                        <table id="detailPegawai" class="table table-condensed table-bordered table-hover">
                            <thead>
                                <tr>
                                    <th>Nama</th>
                                    <th>Jabatan</th>
                                    <th style="width:10%;text-align:center">&nbsp;&nbsp;&nbsp;</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                        <div id="loadDetailPegawai" style="display:none">
                            <div class="loader">Loading...</div>
                        </div>
                    </div>
                    <div id="addPegawaiDetail" style="display:none">
                        <form class="form-horizontal">
                            <div class="form-group">
                                <label for="NpCstm" class="col-sm-2 control-label">Nama Pegawai :</label>
                                <div class="col-sm-10">
                                    <input type="text" class="form-control" id="NpCstm" placeholder="Masukan Nama Pegawai....">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="JbCstm" class="col-sm-2 control-label">Jabatan :</label>
                                <div class="col-sm-10">
                                    <input type="text" class="form-control" id="JbCstm" placeholder="Masukan Jabatan.....">
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-sm-offset-2 col-sm-10">
                                    <button type="button" class="btn btn-info">Tambahkan</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

@* modal penandatangan pengaturan *@
<div id="settingPenandatangan" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="settingPenandatangan">
    <div class="modal-dialog modal-lg" role="document" style="padding-top:30px">
        <div class="modal-content" style="padding:20px">
            <h2>Penandatangan Surat</h2>
            <hr />
            <div class="row">
                <div class="col-md-2 col-sm-3 col-xs-12" style="padding-top:4px">
                    <label class="control-label" for="skemattd">Skema</label>
                </div>
                <div class="col-md-10 col-sm-9 col-xs-12">
                    @Html.DropDownList("skemattd", lstskemattd, new { @class = "select2_single form-control input-md", @id = "skemattd", @onchange = "AnShowHide()", @style = "width:100%" })
                </div>
            </div>
            <div class="row sr-only" style="margin-top:10px" id="anfield">
                <div class="col-md-2 col-sm-3 col-xs-12" style="padding-top:4px">
                    <label class="control-label" for="anttd">Atas Nama</label>
                </div>
                <div class="col-md-10 col-sm-9 col-xs-12">
                    @Html.DropDownListFor(model => model.AtasNama, listAtasNama, "Pilih.....", new { @class = "select2_single form-control input-md", @id = "anttd", @style = "width:100%" })
                </div>
            </div>
            <div class="row" style="margin-top:10px">
                <div class="col-md-2 col-sm-3 col-xs-12" style="padding-top:4px">
                    <label class="control-label" for="ProfilePengirim">Penandatangan</label>
                </div>
                <div class="col-md-10 col-sm-9 col-xs-12">
                    <div class="input-group" style="margin-bottom:0px">
                        <select id="ProfilePengirim" class="select2_single form-control input-md" required="required" style="width:100%">
                            <option value="">Pilih.....</option>
                            @foreach (var p in ViewBag.ListTujuanProfile)
                            {
                                if (p.Jabatan.Contains("Kepala") || p.Jabatan.Contains("Jenderal") || p.Jabatan.Contains("Sekretaris") || p.Jabatan.Contains("Menteri") || p.Jabatan.Contains("Direktur"))
                                {
                                    <option value="@p.ProfileId" data-pegawaiid="@p.PegawaiId" data-nama="@p.Nama" data-jabatan="@p.Jabatan">@p.Jabatan</option>
                                }
                                else
                                {
                                    <option value="@p.ProfileId" data-pegawaiid="@p.PegawaiId" data-nama="@p.Nama" data-jabatan="@p.Jabatan">@p.Jabatan - @p.Nama</option>
                                }
                            }
                        </select>

                        @*@Html.DropDownListFor(model => model.ProfilePengirim, Model.ListProfile, "Pilih.....", new { @class = "select2_single form-control input-md", @required = "required", @style = "width:100%" })*@
                        <span class="input-group-addon" style="padding-bottom:0;padding-top:8px;">
                            <label for="TanpaGelar">Tanpa Gelar</label>&nbsp;
                            @Html.CheckBoxFor(model => model.TanpaGelar)
                        </span>
                    </div>
                    <span id="pengaturanttdWarning" style="color:red;display:none"></span>
                </div>
            </div>
            <hr />
            <div class="row">
                <div class="input-group">
                    <div class="input-group-addon" style="padding-bottom:0;padding-top:10px">
                        @Html.CheckBox("adHoc")&nbsp;
                        <label for="adHoc">Jabatan AdHoc</label>
                    </div>
                    <input type="text" class="form-control" id="adhoctxt" placeholder="Masukan Jabatan Adhoc">
                </div>
                <span id="adhocErr" style="color:red;display:none">Anda Belum Memasukan Jabatan Adhoc <br></span>
                <span style="font-size:.9em">
                    *Jabatan AdHoc digunakan apabila penandatangan mengatasnamakan dirinya dengan jabatan selain jabatan struktural.
                    contoh : Kuasa Pengguna Anggaran, Ketua Gugus Tugas Covid-19
                </span>
            </div>
            <hr />
            <button type="button" class="btn btn-primary btn-sm btn-block" id="simpanPengaturanTTD">Simpan</button>
        </div>
    </div>
</div>

<script src='@Url.Content("~/resources/js/pdfobject.min.js")'></script>
<script type="text/javascript">
    var $listTujuan = "";
    var $listTembusan = "";
    var dfFileDokumen = null;
    var tte = "0";
    let islampiranChange = false;

    const Cdokid = "@Model.DraftCode"
    @if (ViewBag.Salin)
    {
        <text>
            const isSalin = true;
        </text>
    }
    else
    {
        <text>
            const isSalin = false;
        </text>
    }
    // // ---------- FUNCTION MENAMBAH KOLOM ----------
    $(document).ready(function () {
        var atasnama = '@Model.AtasNama'
        $("#TampilanPengirim").val("")
        if (atasnama != '') { $("#skemattd").val("AN") }
        AnShowHide()
        tembusansuratberubah()
        $('#tujuansurat').hide();
        $.validator.methods.number = function (value, element) {
            return this.optional(element) || /^-?(?:\d+|\d{1,3}(?:\.\d{3})+)?(?:,\d+)?$/.test(value);
        }

        $('.select2_single').select2({ width: 'resolve' });

        $('#ListPegawaiModal').on('shown.bs.modal', function () {
            $(this).find('.modal-dialog').css({
                width: '98%',
                height: '98 %',
                'max-height': '98%'
            });
        });

        createPagingPenandatangan();

        //buat surat pernyataan
        @if(Model.TipeSurat == "Surat Pernyataan")
        {
            <text>
            tinymce.init({
            selector: '#UntukPernyataan',
            plugins:[
            'advlist lists paste',
            'searchreplace wordcount fullscreen',
            'insertdatetime table contextmenu ',
            ],
            paste_as_text: true,
            toolbar: 'undo redo | bold italic underline | alignleft aligncenter alignright alignjustify  | bullist numlist outdent indent',
            content_css: '@Url.Content("~/resources/tinymce/tinycss.css")',
            height: '600',
            setup: function(editor) {
                    var redrawisi = $(`@Html.Raw(Model.IsiSurat)`)
                    editor.on('init', function(e) {
                        editor.setContent($(redrawisi[1]).html());
                        });
                }
            });
            </text>
        }
        if (Cdokid) {
            $("#btnsimpan").prop("disabled",false)
        }

        if (Cdokid || isSalin) {
            //isi
            drawIsiSurat()
            if (Cdokid) {
                //tampilan
                $("#tabStep6").show()
                var objurl = '@Url.Action("JoinNdLampiran", "NaskahDinas")?draftcode=' + String(Cdokid);

                objpdf = objurl;

                if ($("#tampilanDokumen").height() < 500) $("#tampilanDokumen").height(500);
                PDFObject.embed(objpdf, $("#tampilanDokumen"), { forcePDFJS: true, PDFJS_URL: '@Url.Content("~/Contents/pdfviewer.html")' });
            }
            //perihal
            $("#PerihalContent").html(`@Html.Raw(Model.Perihal)`)

            //pengirimsurat
            $("#ProfilePengirim").val("@Model.ProfilePengirim")
            $("#ProfilePengirim").trigger("change")
            let adhoc = "@Model.JabatanAdhoc"
            if (adhoc) {
                $("#adHoc").prop("checked", true);
                $("#adHoc").trigger('change')
                $("#adhoctxt").val(adhoc)
                $("#simpanPengaturanTTD").trigger("click")
            } else {
                $("#simpanPengaturanTTD").trigger("click")
            }

            //lampiran

            @*const CLmapiranId = "@Model.LampiranId";
            if (CLmapiranId) {
                $('#divUpload').hide();
                var objurl = '@Url.Action("getLampiranFile", "NaskahDinas")?id=' + CLmapiranId;
                objpdf = objurl;

                if ($("#fileDokumen").height() < 500) $("#fileDokumen").height(500);
                PDFObject.embed(objpdf, $("#fileDokumen"), { forcePDFJS: true, PDFJS_URL: '@Url.Content("~/Contents/pdfviewer.html")' });
            }*@


            @if (Model.isHaveLampiran)
            {
                <text>
                    loadExisistingLampiran()
                </text>
            }

            // Tembusan
            @{
                string tembusan = Model.listTembusan;
            }
            var tembusan = ('@tembusan').split("|");
            if (tembusan.length > 0) {
                $('#datatembusan').html("");
                $.each(tembusan, function (i, rst) {
                    var sp = rst.split("%")
                    if (sp[0]) {
                        $('#datatembusan').append("<tr><td>" + sp[0] + "<span hidden>" + rst + "</span></td><td style='width: 40px;cursor: pointer;' onclick='editTembusan(this)'><i class='fa fa-pencil'></i></td><td style='width: 40px;cursor: pointer;' onclick='hapusTembusan(this)'><i class='fa fa-trash'></i></td></tr>");

                    }
                });
            }


            // Penandatangan
            @{
                string tte = string.Empty;
                if(Model.TTE != null)
                {
                    foreach (var tj in Model.TTE)
                    {
                        tte += string.IsNullOrEmpty(tte) ? "" : "||";
                        tte += string.Concat(tj.PegawaiId, "*|", tj.ProfileId, "*|", tj.Nama, "*|", tj.Jabatan, "*|", tj.Tipe);
                    }
                }
            }
            var tte = ('@tte').split("||");
            if (tte.length > 0) {
                $('#datatte').html("");
                $.each(tte, function (i, rst) {
                    var t = rst.split("*|");
                    var tipe = "Paraf";
                    if (t[4] == "1") {
                        tipe = "Tanda Tangan";
                    }
                    $('#datatte').append("<tr><td style='width: 152px'><label style='display:none;'>" + t[0] + "," + t[4] + "," + t[1] + "</label>" + t[0] + "</td><td style='width: 123px'>" + t[2] + "</td><td>" + t[3] + "</td><td style='width: 100px'>" + tipe + "</td><td style='width: 40px;cursor: pointer;' onclick='hapusPenandatangan(this)'><i class='fa fa-trash'></i></td></tr>");
                });
                recheckPenandatangan();
            }
            SelectOptUnitKerja()
        }

    })

    function hapus(field) {
        $('#' + field).remove()
    }

    var menimbangCount = 1
    function tambahMenimbang(isi) {
        if (!isi) {
            isi = "";
        }
        menimbangCount +=1
        var menimbangField = $("#menimbang")
        menimbangField.append(`

          <div class="form-group" id="menimbangField${menimbangCount}">
               <div id="menimbang${menimbangCount}" class="editableContent textinput" style="border: 1px solid #ccc;min-height:100px; padding:10px; color:black" contenteditable="true" placeholder = "bahwa berdasarkan pertimbangan ........">${isi}</div>
         <span class="hapusField" onclick="hapus('menimbangField${menimbangCount}')" style="position:absolute; right: 15px;"><i class="fa fa-trash"></i> Hapus</span>
         </div>


        `)
    }

    var mengingatCount = 1
    function tambahMengingat(isi) {
        if (!isi) {
            isi = ''
        }
        mengingatCount += 1
        var mengingatField = $("#mengingat")
        mengingatField.append(`
             <div class="form-group" id="mengingatField${mengingatCount}">
               <div id="mengingat${mengingatCount}" class="editableContent textinput" style="border: 1px solid #ccc;min-height:100px; padding:10px; color:black" contenteditable="true" placeholder = "Undang-Undang Nomor ........ (Lembaran Negara ........ )">${isi}</div>
              <span class="hapusField" onclick="hapus('mengingatField${mengingatCount}')" style="position:absolute; right: 15px;"><i class="fa fa-trash"></i> Hapus</span>
            </div>
        `)
    }

    var keberapaCount = 1
    function tambahKeberapa(ke, isi) {
        if (!isi && !ke) {
            isi = ''
            ke = ''
        }
        keberapaCount += 1
        var keberapaField = $("#keberapa")
        keberapaField.append(`
             <div class="form-group keberapaFieldText" id="keberapaField${keberapaCount}">
                <div class="col-md-2 col-sm-10 co-xs-12">
                <input type="text" placeholder="KE....." class="form-control" value="${ke}"/>
                </div>

                <div class="col-md-10 col-sm-10 co-xs-12" style="padding-left:0; margin-bottom:10px">
                    <div id="keberapa${keberapaCount}" class="editArea textinput editableContent" style="border: 1px solid #ccc;min-height:100px; padding:10px; color:black" contenteditable="true" placeholder="memutuskan bahwa ........">${isi}</div>
                   <span class="hapusField" onclick="hapus('keberapaField${keberapaCount}')" style="position:absolute; right: 15px;"><i class="fa fa-trash"></i> Hapus</span>
                </div>
            </div>
        `)
    }

    // // ---------- FUNCTION MODAL TANDATANGAN DAN PARAF ----------


    $("#BtnTambahParaf").on("click", function (e) {
        tte = "0"
        $("#txtJabatan").val("");
        $("#txtNama").val("");
        dtableDaftarPegawai.ajax.reload(null, true);
        $('#popuptitle').html('Daftar Pegawai');
        $('#ListPegawaiModal').modal('show');

        e.preventDefault();
        return false;
    });

    $("#BtnTambahTandaTangan").on("click", function (e) {
        tte = "1"
        $("#txtJabatan").val("");
        $("#txtNama").val("");
        dtableDaftarPegawai.ajax.reload(null, true);
        $('#popuptitle').html('Daftar Pegawai');
        $('#ListPegawaiModal').modal('show');
        $('#ErrPenandatangan').hide();

        e.preventDefault();
        return false;
    });

    $("#btncaripegawai").on("click", function (e) {
        dtabeldaftarpegawaireload()
    });

    function dtabeldaftarpegawaireload() {
        dtableDaftarPegawai.ajax.reload(null, true);
    }

    var dtableDaftarPegawai;
    var createPagingPenandatangan = function () {
        dtableDaftarPegawai = $('#myTableDaftarPegawai').DataTable({
            "bLengthChange": false,
            "paging": true,
            "pageLength": 10,
            "bFilter": false,
            "ordering": false,
            "info": false,
            "processing": true,
            "serverSide": true,
            "ajax": {
                url: '@Url.Action("GetPegawaiForTTE", "NaskahDinas")',
                type: "POST",
                data: function (data) { var ftp = $('#frmDaftarPegawai').serializeArray(); data.form = ftp; ftp.push({ name: "draw", value: data.draw }, { name: "start", value: data.start }, { name: "length", value: data.length }, { name: "metadata", value: $('#UserTTE').val() }, { name: "namajabatan", value: $('#txtJabatan').val() }, { name: "namapegawai", value: $('#txtNama').val() }, { name: "tipe", value: tte }, {name: "unitkerjaid", value: $('#slctUnitKerja').val()} ); return ftp; }
            },
            "columns": [
                { "data": "RNumber", "className": "centertaligncolumn", "width": "5%" },
                { "data": "PegawaiId" },
                { "data": "Nama" },
                { "data": "Jabatan" },
                {
                    "data": "Pilih",
                    "className": "centertaligncolumn",
                    "width": "10%",
                    render: function () {
                        return '<i class="fa fa-check" style="cursor: pointer; color:#b72a2a;"></i>';
                    }
                }
            ]
        });
    };

    $('#myTableDaftarPegawai tbody').delegate('tr i', 'click', function (e) {
        e.preventDefault();
        var data = dtableDaftarPegawai.row($(this).closest('tr')).data();
        var metadata = data.PegawaiId;
        if ($('#datatte').html().indexOf("Penandatangan Kosong") != -1) {
            $('#datatte').html("");
        }
        var tipe = "Paraf";
        if (tte == "1") {
            $('#BtnTambahParaf').hide();
            $('#BtnTambahTandaTangan').hide();
            $('#btnsetujudankirim').prop('disabled', false);
            $('#btnsimpandankirim').prop('disabled', false);
            tipe = "Tanda Tangan";
        }
        $('#datatte').append("<tr><td style='width: 152px'><label style='display:none;'>" + data.PegawaiId + "," + tte + "," + data.ProfileId + "</label>" + data.PegawaiId + "</td><td style='width: 123px'>" + data.Nama + "</td><td>" + data.Jabatan + "</td><td style='width: 100px'>" + tipe + "</td><td style='width: 40px;cursor: pointer;' onclick='hapusPenandatangan(this)'><i class='fa fa-trash'></i></td></tr>");
        metadata += "," + tte;
        $('#UserTTE').val($('#UserTTE').val() + "|" + metadata);
        $('#ListPegawaiModal').modal('hide');
    });

    function hapusPenandatangan(e) {
        $(e).closest("tr").remove();
        recheckPenandatangan();
    }

    function recheckPenandatangan() {
        var $tbltte = $("#datatte label");
        var $datas = "";
        $('#ErrPenandatangan').hide();
        $('#BtnTambahParaf').show();
        $('#BtnTambahTandaTangan').show();
        $('#btnsetujudankirim').prop('disabled', true);
        $('#btnsimpandankirim').prop('disabled', true);
        $.each($tbltte, function (i, item) {
            if ($datas != "") $datas += "|"
            $datas += $(this).html();
            if ($(this).html().indexOf(",1,") != -1) {
                $('#BtnTambahTandaTangan').hide();
                $('#btnsetujudankirim').prop('disabled', false);
                $('#btnsimpandankiModelodelim').prop('disabled', false);
            }
        });
        $('#UserTTE').val($datas);
    }


    function tembusansuratberubah() {
        var jenis = $('#jenistembusan').val();

        $('#div_tembusanIN').hide();
        $('#div_tembusanEX').hide();
        if (jenis == "bpn") {
            $('#tembusanIN').val("");
            $('#div_tembusanIN').show();
        } else {
            $('#tembusanEX').val("");
            $('#div_tembusanEX').show();
        }
    };

    function hapusTembusan(e) {
        $(e).closest("tr").remove();
        recheckTembusan();
    }

    function recheckTembusan() {
        var $tblTembusan = $("#datatembusan span");
        var $datas = "";
        $.each($tblTembusan, function (i, item) {
            if ($datas != "") $datas += "|";
            $datas += $(this).html();
        });
        $('#ListTembusanSurat').val($datas);
        if ($datas == "") {
            $('#datatembusan').html("<tr><td colspan='2' style='text-align: center;'>Tembusan Kosong</td></tr>");
        }
    }

    function tambahtembusan(t, v) {
        if (t == "in") {
            if ($('#tembusanIN').val() != "") {
                var val = $('#tembusanIN option:selected span').text();
                var pegawaiid = $('#tembusanIN').val();
                if (v != "") {
                    if ($('#datatembusan').html().indexOf("Tembusan Kosong") != -1) {
                        $('#datatembusan').html("");
                    }
                    $('#datatembusan').append("<tr><td>" + val + "<span hidden>" + pegawaiid + "</span></td><td style='width: 40px;cursor: pointer;' onclick='editTembusan(this)'><i class='fa fa-pencil'></i></td><td style='width: 40px;cursor: pointer;' onclick='hapusTembusan(this)'><i class='fa fa-trash'></i></td></tr>");
                }
            }
        } else if (t == "ex") {
            var val = $('#tembusanEX').val();
            var pegawaiid = val + "%" + val
            if (val != "") {
                if ($('#datatembusan').html().indexOf("Tembusan Kosong") != -1) {
                    $('#datatembusan').html("");
                }
                $('#datatembusan').append("<tr><td>" + val + "<span hidden>" + pegawaiid + "</span></td><td style='width: 40px;cursor: pointer;' onclick='editTembusan(this)'><i class='fa fa-pencil'></i></td><td style='width: 40px;cursor: pointer;' onclick='hapusTembusan(this)'><i class='fa fa-trash'></i></td></tr>");
            }
        }
    }

    function GetPegawaibyUnit(el) {
        var valueid = el.value;
        var redaksi = $(el).attr("data-redaksi");
        var idname;
        var form = $("#formsearch").serializeArray();
        form.push({ name: "unitkerjaid", value: valueid }, { name: "namajabatan", value: "" }, { name: "namapegawai", value: "" })
        let namasatker = $(el).find("option:selected").text();
        $.ajax({
            url: '@Url.Action("GetPegawaiByUnitKerjaJabatanNama", "NaskahDinas")',
            type: "POST",
            data: form,
            success: function (rst) {
                if (redaksi == "asli") {
                    idname = '#tujuanIN'
                } else if (redaksi == "tembusan") {
                    idname = '#tembusanIN'
                }
                $(idname).children('option').remove();
                $(idname).html("");
                $(idname).append($('<option></option>').val("").html("Pilih Tujuan"));
                var i;
                for (i = 0; i < rst.data.length; i++) {
                    var jbt = rst.data[i].Jabatan
                    if (jbt.includes("Kepala ") || jbt.includes("Sekretaris ") || jbt.includes("Menteri ") || jbt.includes("Inspektur ") || jbt.includes("Direktur ") || jbt.includes("Staf Ahli ") || jbt.includes("Staf Khusus ") || jbt.includes("Tenaga Ahli ") ){
                        if (jbt == "Sekretaris Direktorat Jenderal") { jbt = namasatker.replace("Sekretariat", "Sekretaris") }
                        $(idname).append(
                            $('<option></option>').val(jbt + "%" + rst.data[i].ProfileId).html("<span>" + jbt + "</span>"));
                    }
                    else {
                        if (redaksi != "asli" && $("#tipesurat").val() != "Nota Dinas") {
                            $(idname).append(
                                $('<option></option>').val((rst.data[i].NamaLengkap + "%" + rst.data[i].ProfileId).html(`
                                <span>${rst.data[i].NamaLengkap}</span> - (${jbt})`)));
                        }

                    }
                }
            }

        });
    }

    function AnShowHide() {
        var skema = $('#skemattd').val()
        if (skema == "L") {
            $('#anfield').addClass("sr-only")
        } else if (skema == "AN") {
            $('#anfield').removeClass("sr-only")
        }
    }


    var issave = false;
    let ajukan = false;
    $("#btnsimpan").on("click", function (e) {
        ajukan = true;
        DoTampilkanDokumen()
    })

    function ajukanKonsep(dc) {
        $.ajax({
            url: '@Url.Action("PengajuanDraft", "NaskahDinas")',
            type: "POST",
            data: { id: dc},
            success: function (rst, textStatus, jqXHR) {
                if (rst && rst.Status) {
                    swal({
                        title: "Informasi",
                        text: " Konsep Surat Telah Diajukan",
                        type: "success",
                        timer: 1000,
                        showConfirmButton: false
                    }, function () {
                        window.location.href = '@Url.Action("KoordinasiDraft", "NaskahDinas")?id=' + dc;
                    });
                }
                else {
                    swal("Peringatan", rst.Pesan, "warning")
                }
            },
            error: function (jqXHR, textStatus, errorThrown) { showmsg("Error", errorThrown); $.unblockUI(); }
        });
    }

    function DoTampilkanDokumen() {
        var data = getDataInput()
        if (true) {
            $.unblockUI();
            let pesan = "Menyimpan dan Menampilkan Konsep Surat"
            if (ajukan) { Pesan = "Ajukan Dokumen?" }
            swal({
                title: "Konfirmasi",
                text: pesan,
                type: "info",
                showCancelButton: true,
                closeOnConfirm: false,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "Ya",
                cancelButtonText: "Batal",
                showLoaderOnConfirm: true
            },
                function (isConfirm) {
                    if (isConfirm) {
                        $.ajax({
                            url: '@Url.Action("SimpanDraftNaskahDinas", "NaskahDinas")',
                            type: "POST",
                            data: data,
                            contentType: false,
                            processData: false,
                            success: function (data, textStatus, jqXHR) {
                                if (data && data.Status) {
                                    $('#DraftCode').val(data.Pesan);
                                    $("#tabStep6").show()
                                    $("#btnsimpan").prop("disabled", false)
                                    let thistipesurat = `@Model.TipeSurat`;

                                    if (ajukan) {
                                        ajukanKonsep(data.Pesan)
                                        ajukan = false;
                                    } else if (!Cdokid || islampiranChange) {
                                        window.location.href = `@Url.Action("OpenEditor", "NaskahDinas")?id=${data.Pesan}&konsep=${thistipesurat}&t=true`
                                    } else {

                                        var objurl = '@Url.Action("GenerateDokumenElektronik", "NaskahDinas")?id=' + String(data.Pesan);

                                        objpdf = objurl;
                                        if ($("#tampilanDokumen").height() < 500) $("#tampilanDokumen").height(500);
                                        PDFObject.embed(objpdf, $("#tampilanDokumen"), { forcePDFJS: true, PDFJS_URL: '@Url.Content("~/Contents/pdfviewer.html")' });
                                        swal("Informasi", "Draft berhasil disimpan", "success")

                                        $('.nav-tabs li:eq(6) a').tab('show');

                                    }
                                }
                                else {
                                    swal("Peringatan", data.Pesan, "warning")
                                }
                            },
                            error: function (jqXHR, textStatus, errorThrown) { showmsg("Error", errorThrown); $.unblockUI(); }
                        });
                    }
                });
        } else {
            swal("Peringatan", "Isian Belum LenModelkTipeSuratap", "warning")
            $.unblockUI();
        }
    }

    function getDataInput() {
        var frmdata = new FormData($("#frmStep3")[0]);
        var isiSurat = getIsiSurat()
        recheckTembusan();
        frmdata.append("DraftCode", $('#DraftCode').val());
        frmdata.append("TipeSurat", $('#TipeSurat').val());
        frmdata.append("SifatSurat", "Segera");
        frmdata.append("listTujuan", "SK");
        frmdata.append("KopSurat", $('#kopsurat').val());

        frmdata.append("IsiSurat", encodeURI(isiSurat));
        frmdata.append("KodeArsip", $('#kodearsip').val());
        frmdata.append("listTembusan", $('#ListTembusanSurat').val());
        frmdata.append("Perihal", encodeURI($('#PerihalContent').prop('innerHTML')));
        frmdata.append("ProfilePengirim", $('#ProfilePengirim').val());
        frmdata.append("anttd", $('#anttd').val());
        frmdata.append("JabatanAdhoc", $("#adhoctxt").val());
        var TgBoxCheck = $("#TanpaGelar:checked").length
        var TanpaGelar = (TgBoxCheck) ? true : false
        frmdata.append("TanpaGelar", TanpaGelar);
        if (dfFileDokumen !== null) {
            var namafile = dfFileDokumen.name;
            var fileExt = '.' + namafile.toLowerCase().split('.').pop();
            if (fileExt !== null && fileExt !== '') {
                if (fileExt != ".pdf") {
                    $.unblockUI();
                    showalert("File harus pdf");
                    return false;
                }
                frmdata.append("NamaFileLampiran", namafile);
                frmdata.append("EkstensiLampiran", fileExt);
                frmdata.append("FileLampiran", dfFileDokumen);
            }
            else {
                swal("Peringatan", "File Lampiran tidak diketemukan", "warning")
            }
        }

        recheckPenandatangan();
        if ($("#skemattd").val() == "AN") {
            frmdata.append("AtasNama", $("#anttd").val());
        }
        var metadata = $('#UserTTE').val();
        if (metadata == "") {
            $.unblockUI();
            $('#ErrPenandatangan').show();
            showalert("Penandatangan Harus Dipilih");
            return false;
        }

        let haveLampiran = false;
        if ($(`#fileUploaded ul li`).length > 1) {
            haveLampiran = true;
        }
        if ($(`#fileUploaded ul li[data-save="0"]`).length > 0) {
            islampiranChange = true;
            $(`#fileUploaded ul li[data-save="0"]`).each(function (i, e) {
                let thisid = $(e).children('a').attr("href")
                let thisfilename = $(thisid).find(".filename").html()
                if (thisfilename) {
                    frmdata.append("lstLampiranId", thisfilename);
                }
            })
        }
        if ($(`#fileUploaded ul li[data-save="1"]`).length > 0) {
            if (lampiransaved != $(`#fileUploaded ul li[data-save="1"]`).length) {
                islampiranChange = true;
            }
            $(`#fileUploaded ul li[data-save="1"]`).each(function (i, e) {
                let thisid = $(e).children('a').attr("href")
                let thisfilename = $(thisid).find(".filename").html()
                if (thisfilename) {
                    frmdata.append("lstLampiranIdSave", thisfilename.substring(
                        thisfilename.indexOf("[") + 1,
                        thisfilename.lastIndexOf("]")
                    ));
                }
            })
        }
        frmdata.append("isHaveLampiran", haveLampiran);
        frmdata.append("islampiranChange", islampiranChange);

        frmdata.append("listTTE", metadata);

        issave = true;
        return frmdata;
    }

    function getIsiSurat() {
        var menimbang = "<ol id='menimbang' type='a' style='padding:0; margin-top: 0; padding-left: 30px;text-align:justify;'>"
        $("#menimbang .textinput").each(function () {
            var input = $(this).html()
            menimbang += `<li style='padding-left:5px;'>${input}</li>`
        })
        menimbang += "</ol>"

        var mengingat = "<ol id='mengingat' type='1' style='padding:0; margin-top: 0; padding-left: 30px;text-align:justify;'>"
        $("#mengingat .textinput").each(function () {
            var input = $(this).html()
            mengingat += `<li style='padding-left:5px;'>${input}</li>`
        })
        mengingat += "</ol>"

        var thistipesurat = $('#TipeSurat').val()

        var tabelisi = `
            <table id="PeraturanTable" style="width:100%" border='0'>
                <tr>
                    <th style="width:16%"></th>
                    <th style="width:2%"></th>
                    <th style="width:82%"></th>
                </tr>
                <tr>
                    <td style="vertical-align:top;">Menimbang</td>
                    <td width = "3px" style="vertical-align:top">:</td>
                    <td>${menimbang}</td>
                </tr>
                <tr>
                    <td style="vertical-align:top">@mengingatHead</td>
                    <td style="vertical-align:top">:</td>
                    <td>${mengingat}</td>
                </tr>
        `

        if (thistipesurat == "Surat Keputusan") {
            var menetapkan = $("#menetapkan1").html()
            tabelisi += `
                <tr>
                    <td colspan="3" style="text-align:center;vertical-align:top;padding: 20px 0;">MEMUTUSKAN :</td>
                </tr>
                <tr>
                    <td style="vertical-align:top">Menetapkan</td>
                    <td style="vertical-align:top">:</td>
                    <td style="text-align:justify;"><p id="menetapkan" style="margin-left:10px">${menetapkan.toUpperCase()} </p></td>
                </tr>`
        } else if (thistipesurat == "Surat Tugas") {
            tabelisi += `<tr>
                    <td colspan="3" style="text-align:center;vertical-align:top;padding: 20px 0;">MEMBERI TUGAS :</td>
                </tr>`
            var innerTable = `<table style="border:none;margin-left:10px;" width="100%" id="petugasPegawai">`
            var thiscount = 1;
            var petugasLength = $("#PetugasContainer tbody tr").length
            if ($("#optPetugas").val() == "1") {
                $("#PetugasContainer tbody tr").each(function () {
                    if (petugasLength > 1) {
                        var datadetail = $(this).attr("data-detailpegawai")
                        var inputsplit = datadetail.split("|")
                        if (inputsplit[2]) {
                            innerTable += `<tr class="pegawaidata" data-detailpegawai="${datadetail}">
                                <td style="vertical-align:top" rowspan="4" width = "5%" >${thiscount}.</td>
                                <td style="vertical-align:top" width = "0%">Nama</td>
                                <td style="vertical-align:top" width ="2%">:</td>
                                <td> <span> ${inputsplit[0]} </span></td>
                            </tr>
                            <tr>
                                <td style="vertical-align:top">NIP</td>
                                <td style="vertical-align:top">:</td>
                                <td> <span>${inputsplit[3]} </span></td>
                            </tr>
                            <tr>
                                <td style="vertical-align:top">Pangkat</td>
                                <td style="vertical-align:top">:</td>
                                <td> <span>${inputsplit[2]}</span></td>
                            </tr>
                            <tr>
                                <td style="vertical-align:top">Jabatan</td>
                                <td style="vertical-align:top">:</td>
                                <td> <span>${inputsplit[1]} </span></td>
                            </tr>
                            <tr>
                                <td style="vertical-align:top" colspan="0"> &nbsp;  </td>
                            </tr>
                            `
                        } else {
                            innerTable += `<tr class="pegawaidata" data-detailpegawai="${datadetail}">
                                <td style="vertical-align:top" rowspan="2" width = "5%" >${thiscount}.</td>
                                <td style="vertical-align:top" width = "0%">Nama</td>
                                <td style="vertical-align:top" width ="2%">:</td>
                                <td> <span> ${inputsplit[0]} </span></td>
                            </tr>
                            <tr>
                                <td style="vertical-align:top">Jabatan</td>
                                <td style="vertical-align:top">:</td>
                                <td> <span>${inputsplit[1]} </span></td>
                            </tr>
                            <tr>
                                <td style="vertical-align:top" colspan="0"> &nbsp;  </td>
                            </tr>
                            `
                        }

                        thiscount++
                    } else {
                        var datadetail = $(this).attr("data-detailpegawai")
                        var inputsplit = datadetail.split("|")
                        if (inputsplit[2]) {
                            innerTable += `<tr class="pegawaidata" data-detailpegawai="${datadetail}">
                                <td style="vertical-align:top" width = "0%">Nama</td>
                                <td style="vertical-align:top" width ="2%">:</td>
                                <td> <span> ${inputsplit[0]} </span></td>
                            </tr>
                            <tr>
                                <td style="vertical-align:top">NIP</td>
                                <td style="vertical-align:top">:</td>
                                <td> <span>${inputsplit[3]} </span></td>
                            </tr>
                            <tr>
                                <td style="vertical-align:top">Pangkat</td>
                                <td style="vertical-align:top">:</td>
                                <td> <span>${inputsplit[2]}</span></td>
                            </tr>
                            <tr>
                                <td style="vertical-align:top">Jabatan</td>
                                <td style="vertical-align:top">:</td>
                                <td> <span>${inputsplit[1]} </span></td>
                            </tr>
                            <tr>
                                <td style="vertical-align:top" colspan="0"> &nbsp;  </td>
                            </tr>
                            `
                        } else {
                            innerTable += `<tr class="pegawaidata" data-detailpegawai="${datadetail}">
                                <td style="vertical-align:top" width = "0%">Nama</td>
                                <td style="vertical-align:top" width ="2%">:</td>
                                <td> <span> ${inputsplit[0]} </span></td>
                            </tr>
                            <tr>
                                <td style="vertical-align:top">Jabatan</td>
                                <td style="vertical-align:top">:</td>
                                <td> <span>${inputsplit[1]} </span></td>
                            </tr>
                            <tr>
                                <td style="vertical-align:top" colspan="0"> &nbsp;  </td>
                            </tr>
                            `
                        }
                    }
                })
            }
            else if ($("#optPetugas").val() == "0") {
                innerTable += `<tr class="pegawaidata" data-detailpegawai="terlampir">
                                <td style="vertical-align:top">Daftar Terlampir</td>
                            </tr>
                            <tr>
                                <td style="vertical-align:top" colspan="0"> &nbsp;  </td>
                            </tr>`
            }
            innerTable += '</table>'
            tabelisi += `
                <tr>
                    <td style="vertical-align:top">Kepada</td>
                    <td style="vertical-align:top">:</td>
                    <td style="text-align:justify;"> ${innerTable}</td>
                </tr>`
            var UntukTgs = $("#UntukTgs").html()
            tabelisi += `<tr>
                    <td style="vertical-align:top">Untuk</td>
                    <td style="vertical-align:top">:</td>
                    <td style="text-align:justify;"> <div id="UntukTugas" style='margin-left:10px;'> ${UntukTgs} </div></td>
                </tr>`
        }
        else if (thistipesurat == "Surat Pernyataan") {
            tabelisi = `<table id="PeraturanTable" style="width:100%" border='0'>
                <tr>
                    <td colspan="3" style="text-align:justify;vertical-align:top;padding: 20px 0;"> &nbsp;&nbsp; <span> Yang bertanda tangan di bawah ini :</span></td>
                </tr>`
            var innerTable = `<table style="border:none;margin-left:10px;" width="100%" id="petugasPegawai">`
            var thiscount = 1;
            var petugasLength = $("#PetugasContainer tbody tr").length
            if ($("#optPetugas").val() == "1") {
                $("#PetugasContainer tbody tr").each(function () {
                    if (petugasLength > 1) {
                        var datadetail = $(this).attr("data-detailpegawai")
                        var inputsplit = datadetail.split("|")
                        if (inputsplit[2]) {
                            innerTable += `<tr class="pegawaidata" data-detailpegawai="${datadetail}">
                                <td style="vertical-align:top" width = "10%">Nama</td>
                                <td style="vertical-align:top" width ="2%">:</td>
                                <td> <span> ${inputsplit[0]} </span></td>
                            </tr>
                            <tr>
                                <td style="vertical-align:top">NIP</td>
                                <td style="vertical-align:top">:</td>
                                <td> <span>${inputsplit[3]} </span></td>
                            </tr>
                            <tr>
                                <td style="vertical-align:top">Pangkat</td>
                                <td style="vertical-align:top">:</td>
                                <td> <span>${inputsplit[2]}</span></td>
                            </tr>
                            <tr>
                                <td style="vertical-align:top">Jabatan</td>
                                <td style="vertical-align:top">:</td>
                                <td> <span>${inputsplit[1]} </span></td>
                            </tr>
                            <tr>
                                <td style="vertical-align:top" colspan="0"> &nbsp;  </td>
                            </tr>
                            `
                        } else {
                            innerTable += `<tr class="pegawaidata" data-detailpegawai="${datadetail}">
                                <td style="vertical-align:top" rowspan="2" width = "2%" ></td>
                                <td style="vertical-align:top" width = "10%">Nama</td>
                                <td style="vertical-align:top" width ="2%">:</td>
                                <td> <span> ${inputsplit[0]} </span></td>
                            </tr>
                            <tr>
                                <td style="vertical-align:top">Jabatan</td>
                                <td style="vertical-align:top">:</td>
                                <td> <span>${inputsplit[1]} </span></td>
                            </tr>
                            <tr>
                                <td style="vertical-align:top" colspan="0"> &nbsp;  </td>
                            </tr>
                            `
                        }

                        thiscount++
                    } else {
                        var datadetail = $(this).attr("data-detailpegawai")
                        var inputsplit = datadetail.split("|")
                        if (inputsplit[2]) {
                            innerTable += `<tr class="pegawaidata" data-detailpegawai="${datadetail}">
                                <td style="vertical-align:top" width = "20%">Nama</td>
                                <td style="vertical-align:top" width ="2%">:</td>
                                <td> <span> ${inputsplit[0]} </span></td>
                            </tr>
                            <tr>
                                <td style="vertical-align:top">NIP</td>
                                <td style="vertical-align:top">:</td>
                                <td> <span>${inputsplit[3]} </span></td>
                            </tr>
                            <tr>
                                <td style="vertical-align:top">Pangkat</td>
                                <td style="vertical-align:top">:</td>
                                <td> <span>${inputsplit[2]}</span></td>
                            </tr>
                            <tr>
                                <td style="vertical-align:top">Jabatan</td>
                                <td style="vertical-align:top">:</td>
                                <td> <span>${inputsplit[1]} </span></td>
                            </tr>
                            <tr>
                                <td style="vertical-align:top" colspan="0"> &nbsp;  </td>
                            </tr>
                            `
                        } else {
                            innerTable += `<tr class="pegawaidata" data-detailpegawai="${datadetail}">
                                <td style="vertical-align:top" rowspan="4" width = "2%" >${thiscount}.</td>
                                <td style="vertical-align:top" width = "20%">Nama</td>
                                <td style="vertical-align:top" width ="2%">:</td>
                                <td> <span> ${inputsplit[0]} </span></td>
                            </tr>
                            <tr>
                                <td style="vertical-align:top">Jabatan</td>
                                <td style="vertical-align:top">:</td>
                                <td> <span>${inputsplit[1]} </span></td>
                            </tr>
                            <tr>
                                <td style="vertical-align:top" colspan="0"> &nbsp;  </td>
                            </tr>
                            `
                        }
                    }
                })
            }
            else if ($("#optPetugas").val() == "0") {
                innerTable += `<tr class="pegawaidata" data-detailpegawai="terlampir">
                                <td style="vertical-align:top">Daftar Terlampir</td>
                            </tr>
                            <tr>
                                <td style="vertical-align:top" colspan="0"> &nbsp;  </td>
                            </tr>`
            }
            innerTable += '</table>'
            tabelisi += `
                <tr>

                    <td style="text-align:justify;"> ${innerTable}</td>
                </tr>`

            var UntukPernyataan = tinyMCE.get('UntukPernyataan').getContent()

            tabelisi += '</table>'

            tabelisi += `<div id="UntukPernyataan" style="margin-top:-15px;padding:0 10px;">${UntukPernyataan}</div>`



            //var UntukPernyataan = $("#UntukPernyataan").val()
            //tabelisi += `<tr>
            //        <td style="text-align:left;"> <span id="UntukTugas" style='margin-left:10px;'> ${UntukPernyataan} </span></td>
            //    </tr>`
        }
        else if (thistipesurat == "Surat Perintah") {
            var tabelisi = `
            <table id="PeraturanTable" style="width:100%" border='0'>
                <tr>
                    <td style="vertical-align:top;">Menimbang</td>
                    <td width = "3px" style="vertical-align:top">:</td>
                    <td>${menimbang}</td>
                </tr>
                <tr>
                    <td style="vertical-align:top">@mengingatHead</td>
                    <td style="vertical-align:top">:</td>
                    <td>${mengingat}</td>
                </tr>
                <td colspan="3" style="text-align:center;vertical-align:top;padding: 20px 0;">MEMBERI PERINTAH :</td>`
            var innerTable = `<table style="border:none;margin-left:10px;" width="100%" id="petugasPegawai">`
            var thiscount = 1;
            var petugasLength = $("#PetugasContainer tbody tr").length
            if ($("#optPetugas").val() == "1") {
                $("#PetugasContainer tbody tr").each(function () {
                    if (petugasLength > 1) {
                        var datadetail = $(this).attr("data-detailpegawai")
                        var inputsplit = datadetail.split("|")
                        if (inputsplit[2]) {
                            innerTable += `<tr class="pegawaidata" data-detailpegawai="${datadetail}">
                                <td style="vertical-align:top" rowspan="4" width = "5%" >${thiscount}.</td>
                                <td style="vertical-align:top" width = "0%">Nama</td>
                                <td style="vertical-align:top" width ="2%">:</td>
                                <td> <span> ${inputsplit[0]} </span></td>
                            </tr>
                            <tr>
                                <td style="vertical-align:top">NIP</td>
                                <td style="vertical-align:top">:</td>
                                <td> <span>${inputsplit[3]} </span></td>
                            </tr>
                            <tr>
                                <td style="vertical-align:top">Pangkat</td>
                                <td style="vertical-align:top">:</td>
                                <td> <span>${inputsplit[2]}</span></td>
                            </tr>
                            <tr>
                                <td style="vertical-align:top">Jabatan</td>
                                <td style="vertical-align:top">:</td>
                                <td> <span>${inputsplit[1]} </span></td>
                            </tr>
                            <tr>
                                <td style="vertical-align:top" colspan="0"> &nbsp;  </td>
                            </tr>
                            `
                        } else {
                            innerTable += `<tr class="pegawaidata" data-detailpegawai="${datadetail}">
                                <td style="vertical-align:top" rowspan="2" width = "4%" >${thiscount}.</td>
                                <td style="vertical-align:top" width = "20%">Nama</td>
                                <td style="vertical-align:top" width ="2%">:</td>
                                <td> <span> ${inputsplit[0]} </span></td>
                            </tr>
                            <tr>
                                <td style="vertical-align:top">Jabatan</td>
                                <td style="vertical-align:top">:</td>
                                <td> <span>${inputsplit[1]} </span></td>
                            </tr>
                            <tr>
                                <td style="vertical-align:top" colspan="0"> &nbsp;  </td>
                            </tr>
                            `
                        }

                        thiscount++
                    } else {
                        var datadetail = $(this).attr("data-detailpegawai")
                        var inputsplit = datadetail.split("|")
                        if (inputsplit[2]) {
                            innerTable += `<tr class="pegawaidata" data-detailpegawai="${datadetail}">
                                <td style="vertical-align:top" width = "20%">Nama</td>
                                <td style="vertical-align:top" width ="2%">:</td>
                                <td> <span> ${inputsplit[0]} </span></td>
                            </tr>
                            <tr>
                                <td style="vertical-align:top">NIP</td>
                                <td style="vertical-align:top">:</td>
                                <td> <span>${inputsplit[3]} </span></td>
                            </tr>
                            <tr>
                                <td style="vertical-align:top">Pangkat</td>
                                <td style="vertical-align:top">:</td>
                                <td> <span>${inputsplit[2]}</span></td>
                            </tr>
                            <tr>
                                <td style="vertical-align:top">Jabatan</td>
                                <td style="vertical-align:top">:</td>
                                <td> <span>${inputsplit[1]} </span></td>
                            </tr>
                            <tr>
                                <td style="vertical-align:top" colspan="0"> &nbsp;  </td>
                            </tr>
                            `
                        } else {
                            innerTable += `<tr class="pegawaidata" data-detailpegawai="${datadetail}">
                                <td style="vertical-align:top" width = "20%">Nama</td>
                                <td style="vertical-align:top" width ="2%">:</td>
                                <td> <span> ${inputsplit[0]} </span></td>
                            </tr>
                            <tr>
                                <td style="vertical-align:top">Jabatan</td>
                                <td style="vertical-align:top">:</td>
                                <td> <span>${inputsplit[1]} </span></td>
                            </tr>
                            <tr>
                                <td style="vertical-align:top" colspan="0"> &nbsp;  </td>
                            </tr>
                            `
                        }
                    }
                })
            }
            else if ($("#optPetugas").val() == "0") {
                innerTable += `<tr class="pegawaidata" data-detailpegawai="terlampir">
                                <td style="vertical-align:top">Daftar Terlampir</td>
                            </tr>
                            <tr>
                                <td style="vertical-align:top" colspan="0"> &nbsp;  </td>
                            </tr>`
            }
            innerTable += '</table>'
            tabelisi += `
                <tr>
                    <td style="vertical-align:top">Kepada</td>
                    <td style="vertical-align:top">:</td>
                    <td style="text-align:justify;"> ${innerTable}</td>
                </tr>`

            //foreach

            let UntukInTable = `<table id="UntukTugas" style="border:none;margin-left:10px;" width="100%">`
            let CtUntuk = 1
            $("#menetapkanUntuk div .textinput").each(function () {
                var input = $(this).html().trim()
                if (input) {
                    UntukInTable += `<tr><td>${CtUntuk}.</td><td>${input}</td></tr>`
                }
                CtUntuk++
            })
            UntukInTable += "</table>"
            tabelisi += `<tr>
                        <td style="vertical-align:top">Untuk</td>
                        <td style="vertical-align:top">:</td>
                        <td style="text-align:justify;">${UntukInTable}</td>
                    </tr>`
        }


        if (thistipesurat != "Surat Pernyataan") {
            $("#keberapa .keberapaFieldText").each(function () {
                var urutke = $(this).find("input").val()
                var isike = $(this).find(".textinput").html()

                tabelisi += `
                <tr class="isimenetapkan">
                    <td style="vertical-align:top">${urutke}</td>
                    <td style="vertical-align:top">:</td>
                    <td style="text-align:justify;"><div class="menetapakanlistitem" style="margin-left:10px">${isike} </div></td>
                </tr>
            `
            })

            tabelisi += '</table>'
        }


        return tabelisi
    }

    function drawIsiSurat() {
        var redrawisi = $(`@Html.Raw(Model.IsiSurat)`)

        redrawisi.find("#menimbang").children().each(function (index) {
            if (index == 0) {
                $("#menimbang1").html($(this).html())
            } else {
                tambahMenimbang($(this).html())
            }
        })
        redrawisi.find("#mengingat").children().each(function (index) {
            if (index == 0) {
                $("#mengingat1").html($(this).html())
            } else {
                tambahMengingat($(this).html())
            }
        })

        $("#menetapkan1").html($(redrawisi.find("#menetapkan")).html())

        if ($(redrawisi.find("#UntukTugas")).is("table")) {
            let UntukIn = $(redrawisi.find("#UntukTugas"))
            for (var tr of UntukIn.find("tr")) {
                if ($(tr).index() == 1) {
                    let isi = $(tr).find("td:eq(1)").html().trim()
                    $("#UntukTgs").html(isi)
                } else {
                    let isi = $(tr).find("td:eq(1)").html().trim()
                    tambahUntuk(isi)
                }
            }
        } else {
            $("#UntukTgs").html($(redrawisi.find("#UntukTugas")).html())
        }



        var petugasCtInd = 1;
        var petugasCt = 1;
        $("#PetugasHolder").html("")
        var valpetugas = ""
        var petugasLength = redrawisi.find("#petugasPegawai .pegawaidata").length
        redrawisi.find("#petugasPegawai .pegawaidata").each(function () {
            var datadetail = $(this).attr("data-detailpegawai")
            var inputsplit = datadetail.split("|")
            if (inputsplit[0] == "terlampir") {
                $("#optPetugas").val("0")
            } else {
                $("#optPetugas").val("1")
                $("#PetugasContainer tbody").append(`
                                    <tr data-detailpegawai="${datadetail}">
                                        <td>${inputsplit[0]}</td>
                                        <td>${inputsplit[1]}</td>
                                        <td style="text-align:center;">
                                    <i class="fa fa-pencil" onclick="editPetugas(this)"></i>&nbsp;&nbsp;
                                    <i class="fa fa-arrow-up" onclick="UpRowDetail(this)"></i>&nbsp;&nbsp;
                                    <i class="fa fa-arrow-down" onclick="DownRowDetail(this)"></i>&nbsp;&nbsp;
                                    <i class="fa fa-trash" onclick="hapusRowDetail(this)"></td>
                                    </tr>
                                `)
            }
        })
        countJumlahPetugas()
        redrawisi.find("tr.isimenetapkan").each(function (index) {
            if (index == 0) {
                $(this).children().each(function (index) {
                    if (index == 0) {
                        $("#pertama").val($(this).html())
                    } else if (index == 2) {
                        $("#keberapa1").html($(this).find('.menetapakanlistitem').html())
                    }
                })
            } else {
                var keisi = ""
                var memutuskanisi = ""
                $(this).children().each(function (index) {
                    if (index == 0) {
                        keisi = $(this).html()
                    } else if (index == 2) {
                        memutuskanisi = $(this).find('.menetapakanlistitem').html()
                    }
                })
                tambahKeberapa(keisi, memutuskanisi)
            }

        })
    }

    // lampiran
    $("#btnUploadFile").on("change", function (e) {
        var input = $(this),
            numFiles = input.get(0).files ? input.get(0).files.length : 1;
        if (numFiles > 0) {
            var file = dfFileDokumen = input.get(0).files[0];

            if (file.size > 20000 * 1024) {
                dfFileDokumen = null;
                showmsg('Peringatan', 'File maksimum 20Mb');
                $("#namafile").val("");
                $('#fileDokumen').html("");
                return false;
            }
            else {
                $("#validFile").html("");

                if (dfFileDokumen == null) {
                    return false;
                }
                var namafile = dfFileDokumen.name;
                $("#namafile").val(namafile);
                var filedokumen = dfFileDokumen;
                var tipefile = filedokumen.type;

                if (tipefile == 'application/pdf') {
                    var blob = new Blob([dfFileDokumen], { type: "application/pdf;base64" }),
                        objurl = window.URL.createObjectURL(blob);
                    objpdf = objurl;

                    if ($("#fileDokumen").height() < 500) $("#fileDokumen").height(500);
                    PDFObject.embed(objpdf, $("#fileDokumen"), { forcePDFJS: true, PDFJS_URL: '@Url.Content("~/Contents/pdfviewer.html")' });
                }
            }
        }
    });

    var currentpage = 0;
    var totalpage = 0
    $(document).ready(function () {
        if (currentpage == 0) {
            $("#leftAr").hide()
        }
    })

    //function nextpage(arah) {
    //    if (arah == 'right') {
    //        currentpage += 9
    //        SrchKlasArsip()
    //        if (currentpage > 8) {
    //            $("#leftAr").show()
    //        }
    //    } else if (arah == 'left') {
    //        if (currentpage > 8) {
    //            $("#leftAr").show()
    //            currentpage -= 9
    //            SrchKlasArsip()
    //            if (currentpage < 8) {
    //                $("#leftAr").hide()
    //            }
    //        }
    //    }
    //}

    //$('#srchArsipTxt').change(function () {
    //    currentpage = 0
    //})

    function SrchKlasArsip() {
        $("#arsipModal").modal('show')
        if (!$("#contentholder").html().trim()) {
            $("#arspiloader").show()
        }
        var frmdata = new FormData()
        frmdata.append("start", currentpage)
        frmdata.append("KodeKlasifikasi", $('#srchArsipTxt').val())
        $.ajax({
            type: "POST",
            url: '@Url.Action("DaftarKlasifikasiArsip", "NaskahDinas")',
            data: frmdata,
            contentType: false,
            processData: false,
            success: function (data) {
                $("#contentholder").html(data)
                $("#arspiloader").hide()
                var totalserv = $("#contentholder").find('#total').val()
                if (totalserv) {
                    totalpage = totalserv
                    if ((currentpage + 9) > totalpage) {
                        $("#RightAr").hide()
                    } else if ((currentpage + 9) < totalpage) {
                        $("#RightAr").show()
                    }
                } else {
                    $("#RightAr").hide()
                    $("#leftAr").hide()
                }
            }
        })
    }

    $("#contentholder").delegate('table tbody tr td i', 'click', function (e) {
        var kode = $(this).attr('data-klasifikasi')
        $("#kodearsip").val(kode)
        $("#arsipModal").modal('hide')
    })


    var isSuratTugas = "@Model.TipeSurat"
    var jsonData = {};
    if (isSuratTugas == "Surat Tugas") {
        $.ajax({
            url: '@Url.Action("GetPetugasSatker", "NaskahDinas")',
            type: "GET",
            dataType: "JSON",
            success: function (data) {
                jsonData = data
                $('.petugasAuto').autocomplete({
                    lookup: data,
                    lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                        var re = new RegExp('\\b' + $.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                        return re.test(suggestion.value);
                    }
                });
            }
        });
    }

    var petugasct = 1
    function tambahPetugas() {
        petugasct++
        $("#PetugasHolder").append(`
            <div class="petugas row" style="padding:5px 0">
                <div class="col-md-10 col-sm-10 co-xs-12" style="padding-right:0">
                    <input type="text" id="petugas${petugasct}" class = "form-control formfull petugasAuto"  placeholder = "Nama Pegawai ........" value="" required/>
                </div>
                <div class="col-md-2 col-sm-10 co-xs-12" style="padding-right:0">
                    <label class="btn btn-danger" style="margin-right:0" onclick="HapusPetugas(this)">
                        <i class="fa fa-trash"></i>&nbsp;Hapus
                    </label>
                </div>
            </div>
        `)
        $('.petugasAuto').autocomplete({
            lookup: jsonData,
            lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                var re = new RegExp('\\b' + $.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                return re.test(suggestion.value);
            }
        });
    }

    function HapusPetugas(elm) {
        if ($(".petugas").length > 1) {
            $(elm).closest(".petugas").remove();
        } else{
            $(elm).closest(".petugas").find("input").val("");
        }
    }


    function SelectOptUnitKerja() {
        var uk = $("#UnitKerjaDetail").val()
        $("#detailPegawai tbody").html("")
        if (uk && uk != "999") {
            $("#addPegawaiDetail").hide()
            $("#normalPickSelect").show()
            $("#loadDetailPegawai").show()
            $("#UnitKerjaDetail").attr('disabled', true);

            //var datafrm = $("#frmPetugas").serialize()
            $.ajax({
                url: '@Url.Action("GetPegawaiDetailByUnitKerja", "NaskahDinas")?UnitKerjaDetail=' + uk,
                type: "POST",
                success: function (rsp) {
                    if (rsp.length > 0) {
                        for (var pegawai of rsp) {
                            let fs = ""
                            if (pegawai.Pangkat) {
                                fs = pegawai.Pangkat + " (" + pegawai.Golongan + ")"
                            }
                            $("#detailPegawai tbody").append(`
                                    <tr data-detailpegawai="${pegawai.Nama || ''}|${pegawai.NamaJabatan || ''}|${fs|| ''}|${pegawai.PegawaiId || ''}">
                                        <td>${pegawai.Nama}</td>
                                        <td>${pegawai.NamaJabatan}</td>
                                        <td style="text-align:center;"><i class="fa fa-arrow-circle-o-right" style="cursor:pointer;"></i></td>
                                    </tr>
                            `)
                        }
                        $("#UnitKerjaDetail").attr('disabled', false);
                        $("#loadDetailPegawai").hide()
                    }
                }
            })
        } else if (uk == "999") {
            $("#normalPickSelect").hide()
            $("#addPegawaiDetail").show()
        }
    }

    $("#addPegawaiDetail button").click(function () {
        var nama = $("#NpCstm").val()
        var jabatan = $("#JbCstm").val()
        if (nama && jabatan) {
            $("#PetugasContainer tbody").append(`
                                    <tr data-detailpegawai="${nama}|${jabatan}|||">
                                        <td>${nama}</td>
                                        <td>${jabatan}</td>
                                        <td style="text-align:center;">
                                    <i class="fa fa-pencil" onclick="editPetugas(this)"></i>&nbsp;&nbsp;
                                    <i class="fa fa-arrow-up" onclick="UpRowDetail(this)"></i>&nbsp;&nbsp;
                                    <i class="fa fa-arrow-down" onclick="DownRowDetail(this)"></i>&nbsp;&nbsp;
                                    <i class="fa fa-trash" onclick="hapusRowDetail(this)"></td>
                                    </tr>
                                `)
            $("#NpCstm").val("")
            $("#JbCstm").val("")
        }
        else {
            swal("Peringatan", "Masukan Informasi Pegawai", "warning")
        }
    })

    $("#detailPegawai tbody").delegate("tr td i", "click", function (e) {
        var elm = $(this).closest('tr')
        elm.find("td").last().remove()
        elm.append(`<td style="text-align:center;">
                                    <i class="fa fa-pencil" onclick="editPetugas(this)"></i>&nbsp;&nbsp;
                                    <i class="fa fa-arrow-up" onclick="UpRowDetail(this)"></i>&nbsp;&nbsp;
                                    <i class="fa fa-arrow-down" onclick="DownRowDetail(this)"></i>&nbsp;&nbsp;
                                    <i class="fa fa-trash" onclick="hapusRowDetail(this)"></td>`)
        $("#PetugasContainer tbody").append(elm)
        countJumlahPetugas()
    })

    function hapusRowDetail(elms) {
        var elm = $(elms).closest('tr')
        elm.remove()
        countJumlahPetugas()
    }
    function UpRowDetail(elms) {
        var elm = $(elms).closest('tr')
        elm.prev().before(elm);
    }
    function DownRowDetail(elms) {
        var elm = $(elms).closest('tr')
        elm.next().after(elm);
    }
    function countJumlahPetugas() {
        var jumlah = $("#PetugasContainer tbody tr").length
        $("#menetapkan .jumlahPetugas span").html(jumlah)
    }

    $("#tab-content").delegate('.editableTools button, .perihalTools button', 'click', function () {
        var style = $(this).attr("data-style")
        if (style == "bullet") {
            $(this).parent().hide()
            $(this).parent().siblings(".back").show()
        }
        else if (style.includes("list-")) {
            let type = style.split('-')[1]
            let elinsert = `<ol type="${type}" style="padding-left:18px;margin-left:0px;margin-bottom:2px;margin-top:2px;">
                              <li style="padding-left:10px;"></li>
                            </ol>`
            pasteHtmlAtCaret(elinsert, true);
        }
        else { document.execCommand(style) }
    })

    function pasteHtmlAtCaret(html, selectPastedContent) {
        var sel, range;
        if (window.getSelection) {
            // IE9 and non-IE
            sel = window.getSelection();
            if (sel.getRangeAt && sel.rangeCount) {
                range = sel.getRangeAt(0);
                range.deleteContents();

                // Range.createContextualFragment() would be useful here but is
                // only relatively recently standardized and is not supported in
                // some browsers (IE9, for one)
                var el = document.createElement("div");
                el.innerHTML = html;
                var frag = document.createDocumentFragment(), node, lastNode;
                while ((node = el.firstChild)) {
                    lastNode = frag.appendChild(node);
                }
                var firstNode = frag.firstChild;
                range.insertNode(frag);

                // Preserve the selection
                if (lastNode) {
                    range = range.cloneRange();
                    range.setStartAfter(lastNode);
                    if (selectPastedContent) {
                        range.setStartBefore(firstNode);
                    } else {
                        range.collapse(true);
                    }
                    sel.removeAllRanges();
                    sel.addRange(range);
                }
            }
        } else if ((sel = document.selection) && sel.type != "Control") {
            // IE < 9
            var originalRange = sel.createRange();
            originalRange.collapse(true);
            sel.createRange().pasteHTML(html);
            if (selectPastedContent) {
                range = sel.createRange();
                range.setEndPoint("StartToStart", originalRange);
                range.select();
            }
        }
    }

     $("#perubahan").click(function () {
        var datakirim = []
        datakirim.push({ name: "InputText", value: "!RESUBMIT!" } )
        datakirim.push({ name: "DraftCode", value: $("#DraftCode").val() })
        try {
            DoTampilkanDokumen()
            $("#inputText").val("")
             $.ajax({
                type: "POST",
                url: '@Url.Action("infokanPerubahan", "NaskahDinas")',
                data: datakirim,
                 success: function (rsp) {
                     if (rsp["Status"] == false) {
                     } else {
                         $('.nav-tabs li:eq(4) a').tab('show');
                     }
                 }
            })
        }
        catch {
            $.unblockUI();
            showalert("Dokumen Tidak Lengkap");
        }
     })

$("#perubahanverifikator").click(function () {
        var datakirim = []
        datakirim.push({ name: "InputText", value: "!RESUBMITVERIFIKATOR!" })
        datakirim.push({ name: "DraftCode", value: $("#DraftCode").val() })
        try {
            DoTampilkanDokumen()
            $("#inputText").val("")
             $.ajax({
                type: "POST",
                url: '@Url.Action("infokanPerubahanVerifikator", "NaskahDinas")',
                data: datakirim,
                 success: function (rsp) {
                     if (rsp["Status"] == false) {
                     } else {
                         $('.nav-tabs li:eq(4) a').tab('show');
                     }
                 }
            })
        }
        catch {
            $.unblockUI();
            showalert("Dokumen Tidak Lengkap");
        }
    })



     //editableContent
    $("#tab-content").delegate(".editableContent", "focusin", function () {
        tinymce.init({
            selector: '.editableContent',
            inline: true,
            menubar: false,
            plugins: [
                'advlist lists paste',
                'searchreplace wordcount fullscreen',
                'insertdatetime table contextmenu ',
            ],
            toolbar: 'bold italic underline | bullist numlist'
        });
        //$(".editableTools").remove()
        //let editContentTools = `
        //     <div class="btn-group-vertical editableTools" role="group" aria-label="...">
        //        <div class="front">
        //            <button type="button" class="btn btn-default" data-style="bold"><b>B</b></button>
        //            <button type="button" class="btn btn-default" data-style="italic"><i>I</i></button>
        //            <button type="button" class="btn btn-default" data-style="underline"><u>U</u></button>
        //            <button type="button" class="btn btn-default" data-style="bullet"><i class="fa fa-list" aria-hidden="true"></i></button>
        //        </div>
        //        <div class="back" style="display:none">
        //            <button type="button" class="btn btn-default" data-style="list-A">A</button>
        //            <button type="button" class="btn btn-default" data-style="list-a">a.</button>
        //            <button type="button" class="btn btn-default" data-style="list-1">1.</button>
        //            <button type="button" class="btn btn-default" data-style="list-I" style='font-family: "Times New Roman", Times, serif;'>I.</button>
        //            <button type="button" class="btn btn-default" data-style="list-i" style='font-family: "Times New Roman", Times, serif;'>i.</button>
        //        </div>
        //    </div>`
        //$(this).before(editContentTools)
    })

    //paste text prevent
    //$('#PerihalContent, .editableContent, .editArea').bind('dragover drop', function (event) {
    //    event.preventDefault();
    //    return false;
    //});
    //$('#PerihalContent, .editableContent, .editArea').bind('paste', function (event) {
    //    event.preventDefault();
    //    var text = event.originalEvent.clipboardData.getData("text/plain");
    //    document.execCommand("insertHTML", false, text);
    //});

    $("#tab-content").delegate('#PerihalContent, .editableContent, .editArea', 'paste', function (event) {
        event.preventDefault();
        var text = event.originalEvent.clipboardData.getData("text/plain").trim();
        document.execCommand("insertHTML", false, text);
    })

    $("#tab-content").delegate('#PerihalContent, .editableContent, .editArea', 'dragover drop', function (event) {
        event.preventDefault();
        return false;
    })

    $("#tab-content").delegate('#PerihalContent, .editableContent, .editArea', 'keyup', function (event) {
        if (!$(this).text().trim()) {
            $(this).html('')
        }
    })

    $("#simpanPengaturanTTD").click(function () {
        let skema = $("#skemattd").val()
        $("#adhocErr").hide()
        let profilePengirim = $("#ProfilePengirim").val()
        let TxtPegirim = ""
        if (profilePengirim) {
            if ($("#adHoc").is(':checked')) {
                if (skema == "L" && $("#adhoctxt").val()) {
                    TxtPegirim = `Langsung - ${$("#adhoctxt").val()} ${($("#TanpaGelar").is(':checked')) ? "- Tanpa Gelar" : ""}`
                } else if (!$("#adhoctxt").val()) {
                    $("#adhocErr").show()
                }
            }
            else if (skema == "L") {
                TxtPegirim = `Langsung - ${$("#ProfilePengirim option:selected").text()} ${($("#TanpaGelar").is(':checked')) ? "- Tanpa Gelar" : ""}`
            } else {
                TxtPegirim = `a.n ${$("#anttd option:selected").text()} - ${$("#ProfilePengirim option:selected").text()} ${($("#TanpaGelar").is(':checked')) ? "- Tanpa Gelar" : ""}`
            }
            $("#pengaturanttdWarning").hide()
        } else {
            $("#pengaturanttdWarning").html("Harap Pilih Tujuan Surat")
            $("#pengaturanttdWarning").show()
        }
        if (TxtPegirim) {
            $("#TampilanPengirim").val(TxtPegirim)
            $("#settingPenandatangan").modal('hide')


            var usertte = $('#UserTTE').val()
            tte = "1"
            tipe = "Tanda Tangan";
            $('#BtnTambahTandaTangan').hide();
            $('#BtnTambahParaf').show();
            var pgid = $("#ProfilePengirim option:selected").attr("data-pegawaiid")
            var pfrid = $("#ProfilePengirim").val()
            var nama = $("#ProfilePengirim option:selected").attr("data-nama")
            var jabatan = $("#ProfilePengirim option:selected").attr("data-jabatan")
            if (usertte) {
                //check
                var foreplace = "";
                for (var t of $('#UserTTE').val().split('|')) {
                    var sp = t.split(',')
                    if (sp[1] == "1" && pgid && sp[0] != pgid) {
                        foreplace = t
                        break;
                    }
                }
                if (foreplace) {
                    var tempt = usertte.replace(`|${foreplace}`, "")
                    $('#UserTTE').val(tempt + `|${pgid},${tte}`)
                    $("#datatte tr").each(function (index, element) {
                        var tipette = $(this).children(":first").find("label").text().split(',')
                        if (tipette[1] == "1") {
                            $(element).find("td").each(function (i, e) {
                                if (i == 0) {
                                    $(e).html("<td><label style='display:none;'>" + pgid + "," + tte + "," + pfrid + "</label>" + pgid + "</td>")
                                }
                                else if (i == 1) {
                                    $(e).html("<td>" + nama + "</td>")
                                }
                                else if (i == 2) {
                                    $(e).html("<td>" + jabatan + "</td>")
                                }
                            })
                        }
                    })
                }
            } else {
                if ($('#datatte').html().indexOf("Penandatangan Kosong") != -1) {
                    $('#datatte').html("");
                }
                $('#datatte').append("<tr><td style='width: 152px'><label style='display:none;'>" + pgid + "," + tte + "," + pfrid + "</label>" + pgid + "</td><td style='width: 123px'>" + nama + "</td><td>" + jabatan + "</td><td style='width: 100px'>" + tipe + "</td><td style='width: 40px;cursor: pointer;' onclick='hapusPenandatangan(this)'><i class='fa fa-trash'></i></td></tr>");
                $('#UserTTE').val(`|${pgid},${tte}`)
            }
        } else {

        }
    })

    $("#adHoc").change(function () {
        if ($("#adHoc").is(':checked')) {
            $("#skemattd").val("L")
            $("#skemattd").trigger("change")
        } else {
            $("#adhoctxt").val("")
        }
    })

    let ctfield = 1
    function tambahUntuk(param) {
        if (!param) {
            let menetapkanField = $("#menetapkanUntuk")
            ctfield++
            menetapkanField.append(`
                <div class="form-group" id="menetapkanField${ctfield}">
                    <div id="UntukTgs${ctfield}" class="editableContent textinput" style="border: 1px solid #ccc;min-height:100px; padding:10px; color:black" contenteditable="true" placeholder="Memerintahkan Untuk......"></div>
                <span class="hapusField" onclick="hapus('UntukTgs${ctfield}')" style="position:absolute; right: 15px;"><i class="fa fa-trash"></i> Hapus</span>
                </div>
        `)
        } else {
            let menetapkanField = $("#menetapkanUntuk")
            ctfield++
            menetapkanField.append(`
                <div class="form-group" id="menetapkanField${ctfield}">
                    <div id="UntukTgs${ctfield}" class="editableContent textinput" style="border: 1px solid #ccc;min-height:100px; padding:10px; color:black" contenteditable="true" placeholder="Memerintahkan Untuk......">${param}</div>
                <span class="hapusField" onclick="hapus('UntukTgs${ctfield}')" style="position:absolute; right: 15px;"><i class="fa fa-trash"></i> Hapus</span>
                </div>
        `)
        }
    }

    var onEdit = ""
    function editPetugas(elm) {
        let nest = $(elm).closest('tr')
        let data = nest.attr("data-detailpegawai")
        $("#NamaPetugas").val("")
        $("#JabatanPetugas").val("")
        $("#PangkatPetugas").val("")
        $("#NIPPetugas").val("")
        if (data) {
            let sp = data.split("|")
            $("#NamaPetugas").val(sp[0])
            $("#JabatanPetugas").val(sp[1])

            $("#NIPPetugas").val(sp[3])
            if (sp[2]) {
                $("#PangkatPetugas").val(sp[2])
                $("#PangkatPetugas").prop('disabled', false)
            } else {
                $("#PangkatPetugas").prop('disabled',true)
            }
            onEdit = nest
        }
        $("#EditPetugas").modal("show")
    }

    $("#simpanEditPetugas").click(function () {
        let nama    = $("#NamaPetugas").val()
        let jabatan = $("#JabatanPetugas").val()
        let pangkat = $("#PangkatPetugas").val() ? $("#PangkatPetugas").val() : ""
        let nip     = $("#NIPPetugas").val() ? $("#NIPPetugas").val() : ""
        if (onEdit && nama && jabatan) {
            onEdit.html(`
                <td>${nama}</td>
                <td>${jabatan}</td>
                <td style="text-align:center;">
                    <i class="fa fa-pencil" onclick="editPetugas(this)"></i>&nbsp;&nbsp;
                    <i class="fa fa-arrow-up" onclick="UpRowDetail(this)"></i>&nbsp;&nbsp;
                    <i class="fa fa-arrow-down" onclick="DownRowDetail(this)"></i>&nbsp;&nbsp;
                    <i class="fa fa-trash" onclick="hapusRowDetail(this)"></td>
                </td>
            `)
            onEdit.removeAttr("data-detailpegawai")
            onEdit.attr("data-detailpegawai",`${nama}|${jabatan}|${pangkat}|${nip}`)
        }
        $("#EditPetugas").modal("hide")
    })


    function backToFront() {
        @if (ViewBag.Kembali)
        {
            <text>window.location.href = `@Url.Action("KonsepList", "NaskahDinas")`</text>
        } else
        {
             <text>window.location.href = `@Url.Action("KoordinasiDraft", "NaskahDinas")?id=` + $('#DraftCode').val() </text>
        }
    }

    var fileCount = 0;
    var fileidx = 1;
    function btnTambahFileUp() {
        $(`#file${fileidx}`).trigger("click")
    }

    $("#fileHide").delegate("input[type='file']", "change" ,function () {
        var filename = $(this).attr('id')
        var input = $(this),
            numFiles = input.get(0).files ? input.get(0).files.length : 1;
        if (numFiles > 0) {
            var file = dfFileDokumen = input.get(0).files[0];
            if (file.size > 20000 * 1024) {
                dfFileDokumen = null;
                showmsg('Peringatan', 'File maksimum 20Mb');
                return false;
            }
            else {
                if (dfFileDokumen == null) {
                    return false;
                }
                var namafile = dfFileDokumen.name;
                if (namafile.length > 100) {
                    dfFileDokumen = null;
                    showmsg('Peringatan', 'Nama File Maksimal 100 Karakter');
                    return false;
                }
                var fileExt = '.' + namafile.toLowerCase().split('.').pop();
                if (fileExt !== null && fileExt !== '') {
                    if (fileExt != ".pdf") {
                        showalert("File harus pdf");
                        return false;
                    }

                    var filedokumen = dfFileDokumen;
                    var tipefile = filedokumen.type;

                    afterUploadedFile(filename, namafile, tipefile);
                    fileCount++;
                    fileidx++;
                    $("#fileHide").append(`<input type="file" id="file${fileidx}" name="fileUploadStream" style="display:none">`);
                }

            }
        }
    })

    function afterUploadedFile(filename, namafile, tipefile) {
        $("#fileUploaded ul").prepend(`
            <li role="presentation" data-save="0"><a href="#upload${filename}" aria-controls="upload${filename}" role="tab" data-toggle="tab" style="cursor:pointer"><i class="fa fa-file-pdf-o" style="font-size:1.2em"></i></a></li>
        `)
        $("#tabPdf").prepend(`
            <div role="tabpanel" class="tab-pane fade in" id="upload${filename}">
                <div class="PdfDetail" style="padding:5px 10px; background-color:rgba(222, 222, 222, 1)">
                    <h5> <span  class="filename">${namafile}</span> <span class="hapus pull-right" style="color: red;cursor:pointer;" onclick="HapusPdf(this)">Hapus</span></h5>
                </div>
                <div class="PdfHolder">

                </div>
            </div>
        `)

        if (tipefile == 'application/pdf') {
            var blob = new Blob([dfFileDokumen], { type: "application/pdf;base64" }),
                objurl = window.URL.createObjectURL(blob);
            objpdf = objurl;

            if ($(`#upload${filename} .PdfHolder`).height() < 600) $(`#upload${filename} .PdfHolder`).height(600);
            PDFObject.embed(objpdf, $(`#upload${filename} .PdfHolder`), { forcePDFJS: true, PDFJS_URL: '@Url.Content("~/Contents/pdfviewer.html")' });
        }
        $(`#fileUploaded ul li a[aria-controls="upload${filename}"]`).tab('show');
    }

    function HapusPdf(element) {
        var tabelmnt = $(element).closest('.tab-pane')
        var idelmnt = tabelmnt.attr('id')
        var fileid = idelmnt.replace("upload","");
        $(`#fileUploaded ul li a[aria-controls="${idelmnt}"]`).parent().remove()
        tabelmnt.remove()
        $(`#${fileid}`).remove()
        $(`#fileUploaded ul li a`).first().tab('show');
        fileCount--;
        islampiranChange = true
    }

    let lampiransaved = 0
    function loadExisistingLampiran() {
        let listLampiranId = []
        @if(Model.isHaveLampiran)
        {
            foreach (var l in Model.lstLampiranId)
            {
            <text>
        listLampiranId.push(`@l`)
            </text>
            }
        }
        if (!isSalin) {
            for (let l of listLampiranId) {
                drawLampiran(l)
                lampiransaved++
            }
        }
    }

    function drawLampiran(filename) {
        $("#fileUploaded ul").prepend(`
            <li role="presentation" data-save="1"><a href="#upload${filename}" aria-controls="upload${filename}" role="tab" data-toggle="tab" style="cursor:pointer"><i class="fa fa-file-pdf-o" style="font-size:1.2em"></i></a></li>
        `)
        $("#tabPdf").prepend(`
            <div role="tabpanel" class="tab-pane fade in" id="upload${filename}">
                <div class="PdfDetail" style="padding:5px 10px; background-color:rgba(222, 222, 222, 1)">
                    <h5> <span  class="filename">Lampiran[${filename}]</span> <span class="hapus pull-right" style="color: red;cursor:pointer;" onclick="HapusPdf(this)">Hapus</span></h5>
                </div>
                <div class="PdfHolder">

                </div>
            </div>
        `)

        var blob = new Blob([dfFileDokumen], { type: "application/pdf;base64" }),
        objurl = '@Url.Action("getLampiranFile", "NaskahDinas")?id=' + filename;
        objpdf = objurl;

        if ($(`#upload${filename} .PdfHolder`).height() < 600) $(`#upload${filename} .PdfHolder`).height(600);
        PDFObject.embed(objpdf, $(`#upload${filename} .PdfHolder`), { forcePDFJS: true, PDFJS_URL: '@Url.Content("~/Contents/pdfviewer.html")' });

        $(`#fileUploaded ul li a[aria-controls="upload${filename}"]`).tab('show');
    }

    function editTembusan(elm) {
        let nest = $(elm).parent().children(":first")
        let txt = nest.children('span').text();
        let txts = txt.split("%")
        swal({
            title: "Sunting Teks",
            text: "Teks Sebelumnya: " + txts[0],
            type: "input",
            inputType: "text",
            showCancelButton: true,
            closeOnConfirm: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "Ganti",
            cancelButtonText: "Batal",
            inputPlaceholder: "teksinput",
            showLoaderOnConfirm: false
        },
            function (inputValue) {
                if (inputValue) {
                    nest.html(`${inputValue}<span hidden>${inputValue}%${txts[1]}</span>`)
                }
            });
    }
</script>